# Project Development & Documentation Rules

## üö® FIRST PRIORITY: DOCUMENTATION
**No docs? CREATE THEM FIRST.** Understand the system before coding. Update when understanding changes.

## üîó AUTOMATED LINK MANAGEMENT
**Check for `PythonHelpers/link_manager.py` first**
- If it exists ‚Üí Use it
- If not ‚Üí Create a Python script that:
  - Gets repo owner/name from git remote
  - Finds all web-accessible files (.html, .js, .json, etc.)
  - Generates GitHub Pages URLs: `https://[owner].github.io/[repo]/[path]`
  - Updates LINK.txt with proper URL encoding
  - Preserves existing descriptions

Run after ANY web file changes: `python PythonHelpers/link_manager.py`

---

## üìù DOCUMENTATION FILES
Every `.html` needs a `.txt`: `dashboard.html` ‚Üí `dashboard.txt`

**Required in each .txt:**
- What it does & data sources
- How it works (key functions)  
- Dependencies & integrations
- Corrections when initial understanding was wrong

Update docs with EVERY change. If wrong, fix immediately.

---

## üîÑ Git Rules
**Not on main = didn't happen.** Always work on main. Commit & push immediately after changes. End every response with PR link.

---

## üîó WEB FILE TRACKING (LINK.txt) - NOW AUTOMATED!
**Use the Python Link Manager for automatic tracking:**
```bash
python PythonHelpers/link_manager.py
```

### What Gets Tracked Automatically
**HTML Files** (.html)
- All runnable web pages
- Reason: These are the applications users access directly

**JavaScript Modules** (.js)
- Clean development versions (Jsmodules/*.js)
- Obfuscated production versions (Jsmodules-js/*-js.js)
- Reason: These need to be referenced/imported in web apps

**JSON Data Files** (.json) - if present
- Any data endpoints or configuration files
- Reason: Often loaded dynamically by web apps

**Standalone CSS** (.css) - if present
- Shared stylesheets referenced across pages
- Reason: May be loaded as separate resources

**What's NOT tracked:**
- Python scripts (.py) - run locally, not web-accessible
- CSV files (.csv) - source data, not web resources
- Text files (.txt) - documentation, not web resources

### How It Works
- Generates proper GitHub Pages URLs (https://username.github.io/repo/path/file.html)
- Handles special characters and spaces in filenames
- Preserves existing descriptions when updating

### Manual Review After Running Script
- Check LINK.txt for new entries marked with `[Add description for...]`
- Update these placeholders with meaningful descriptions
- Commit the updated LINK.txt with your code changes

### LINK.txt Format (Auto-generated)
```
# GitHub Pages Links for some-dude-999/LPH
# Auto-generated by PythonHelpers/link_manager.py

## HTML Pages
https://some-dude-999.github.io/LPH/index.html - Main landing page
https://some-dude-999.github.io/LPH/dashboard.html - Analytics dashboard

## JavaScript Modules (Clean - Development)
https://some-dude-999.github.io/LPH/SpanishWords/Jsmodules/act1-foundation.js - Act 1 vocabulary (readable)

## JavaScript Modules (Obfuscated - Production)
https://some-dude-999.github.io/LPH/SpanishWords/Jsmodules-js/act1-foundation-js.js - Act 1 vocabulary (compressed)
```

---

## üì¶ JAVASCRIPT MODULE STRUCTURE (CRITICAL!)
**JS modules are ACT-BASED, NOT pack-based!**

### ‚úÖ CORRECT Structure (Spanish, English)
- **Group by Acts**: Multiple wordpacks combined into act files
- **File naming**: `act1-foundation.js`, `act2-building-blocks.js`, etc.
- **Benefits**:
  - Fewer HTTP requests (7 act files vs 250 pack files)
  - Better performance and caching
  - Cleaner import structure
  - Obfuscation works better on larger files

**Example (Spanish):**
```
SpanishWords/Jsmodules/
‚îú‚îÄ‚îÄ act1-foundation.js (116KB - contains packs 1-50)
‚îú‚îÄ‚îÄ act2-building-blocks.js (119KB - contains packs 51-100)
‚îî‚îÄ‚îÄ act3-daily-life.js (171KB - contains packs 101-150)
```

### Data Structure (ALL Languages)
Each language module exports multiple pack constants with **identical structure**:

```javascript
export const p{act}_{pack}_{name} = {
  meta: {
    wordpack: 1,           // Pack number (integer)
    english: "Title",      // Pack title in English
    chinese: "Ê†áÈ¢ò",        // Pack title in Chinese (if supported)
    pinyin: "biƒÅot√≠",      // Pack title in Pinyin (if supported)
    spanish: "T√≠tulo",     // Pack title in Spanish (if supported)
    portuguese: "T√≠tulo"   // Pack title in Portuguese (if supported)
    // ... other languages as supported by that language's dataset
  },
  words: [
    ["word1_col1", "word1_col2", "word1_col3", ...],  // Array of strings
    ["word2_col1", "word2_col2", "word2_col3", ...],
    // ... each word is an array of translations/data
  ]
}
```

**Key Points:**
- ‚úÖ Structure is **identical** across all languages (meta object + words array)
- ‚úÖ Each language has **different columns** based on supported translations
- ‚úÖ Spanish: 5 columns (spanish, english, chinese, pinyin, portuguese)
- ‚úÖ Chinese: 12 columns (chinese, pinyin, english, spanish, french, portuguese, vietnamese, thai, khmer, indonesian, malay, filipino)
- ‚úÖ English: 5 columns (english, chinese, pinyin, spanish, portuguese)
- ‚úÖ Words array is **always** an array of arrays of strings

### ‚ùå INCORRECT Structure (Pack-Based - DEPRECATED)
**NEVER use individual pack files:**
- **File naming**: `pack1-greetings.js`, `pack2-pronouns.js`, etc.
- **Problems**:
  - 107+ separate HTTP requests
  - Poor performance
  - Harder to manage
  - Defeats obfuscation purpose

### Conversion Scripts
- **Location**: `[Language]Words/[Language]WordsPythonHelperScripts/convert_csv_to_js.py`
- **Input files needed**:
  - `[Language]WordsOverview.csv` - Maps packs to acts
  - `[Language]WordsMeta.csv` - Translations for pack titles (optional)
  - `[Language]Words{1-250}.csv` - Individual wordpack data
- **Output**:
  - Clean: `Jsmodules/act{N}-{name}.js` (readable for development)
  - Obfuscated: `Jsmodules-js/act{N}-{name}-js.js` (compressed for production)

### When to regenerate modules
- After editing any CSV file
- After changing act groupings in Overview.csv
- After updating meta translations
- Run: `python [Language]Words/[Language]WordsPythonHelperScripts/convert_csv_to_js.py`

---

## üîì DECODER: How to Use Obfuscated Files

### Obfuscation Method
Obfuscated files (`*-js.js`) use **3-layer protection**:
1. **Base64 encoding** - Safe transport in JavaScript strings
2. **Zlib compression** - 60%+ file size reduction
3. **String reversal** - Salt to prevent casual JSON parsing

### Decoder Implementation (Used in game.js)

**Dependencies:**
```html
<!-- Required: pako.js for zlib decompression -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
```

**Decoder Function:**
```javascript
async function decodeObfuscatedModule(url) {
  try {
    // 1. Import the obfuscated module (contains base64 string in 'w' export)
    const module = await import(url);
    const compressedB64 = module.w;

    // 2. Decode base64 to binary
    const compressedBinary = Uint8Array.from(atob(compressedB64), c => c.charCodeAt(0));

    // 3. Decompress with pako (zlib)
    const decompressedBinary = pako.inflate(compressedBinary);

    // 4. Convert binary to string
    const reversedJson = new TextDecoder('utf-8').decode(decompressedBinary);

    // 5. Reverse the string (undo the salt)
    const jsonStr = reversedJson.split('').reverse().join('');

    // 6. Parse JSON to get the original data
    const data = JSON.parse(jsonStr);

    return data;  // Returns object with all packs: { p1_1_name: {meta, words}, ... }
  } catch (error) {
    console.error('Failed to decode module:', error);
    throw error;
  }
}
```

**Usage Example:**
```javascript
// Load Spanish Act 1
const spanishAct1 = await decodeObfuscatedModule(
  './SpanishWords/Jsmodules-js/act1-foundation-js.js'
);

// Access individual packs
const greetings = spanishAct1.p1_1_greetings__goodbyes;
console.log(greetings.meta.wordpack);  // 1
console.log(greetings.words[0]);       // ["hola amigo", "hello friend (masculine)", ...]
```

### Testing Decoder
Use **DecoderTest.html** to verify all obfuscated files decode correctly:
- Located at: `/DecoderTest.html`
- Tests all three languages (Chinese, Spanish, English)
- Displays decoded data in tables
- GitHub Pages: `https://some-dude-999.github.io/LPH/DecoderTest.html`

---

## ‚ö†Ô∏è Remember
1. **NO DOCUMENTATION = STOP! Create it first before ANY other work**
2. **Check for PythonHelpers/link_manager.py first - use it if it exists!**
3. **Not on main = useless code**
4. **Incorrect understanding = update documentation immediately**
5. **Every change needs this exact sequence:**
   - Check/create documentation FIRST
   - Make code changes
   - Update documentation if understanding changed
   - **Run `python PythonHelpers/link_manager.py`** (auto-updates LINK.txt for all web files)
   - Review and update descriptions in LINK.txt
   - Git add, commit, push to main
   - Provide pull request link in response
6. **Documentation is a message to your future self - make it count!**

## üéØ Quick Start Checklist for New Sessions
```bash
# 1. Check if link manager exists
ls PythonHelpers/link_manager.py

# 2. If not found, create it to track .html, .js, .json, .css files
mkdir -p PythonHelpers
# [create link_manager.py with the provided code]

# 3. After any web file changes (HTML, JS, JSON, CSS), run:
python PythonHelpers/link_manager.py

# 4. Review and update LINK.txt descriptions

# 5. Commit everything
git add .
git commit -m "Updated web files and documentation"
git push origin main
```

## Documentation Template Example
```text
=== [Component Name].txt ===
PROJECT: [Project Name]
COMPONENT: [This Component's Purpose]
CREATED: [Date]
LAST UPDATED: [Date] - [What Changed]

DATA SOURCES:
- API: [endpoint URL] - [what data it provides]
- File: [filename] - [what data it contains]
- User Input: [form fields] - [what users provide]

FUNCTIONALITY:
- Main Purpose: [What this does]
- Key Functions:
  * functionName() - [what it does]
  * anotherFunction() - [its purpose]
- Event Handlers: [user interactions handled]

DEPENDENCIES:
- External Libraries: [library names and versions]
- Project Files: [other files this needs]
- APIs Required: [external services]

INTEGRATION:
- Receives data from: [other components]
- Sends data to: [other components]
- Triggers: [what causes this to run]

CORRECTIONS & CLARIFICATIONS:
[Document any initial misunderstandings that were corrected]
- Initially thought: [wrong assumption]
- Actually: [correct understanding]
- Why this matters: [impact on functionality]

NOTES:
[Any special considerations, known issues, or future improvements needed]
[Tips for future LLMs working on this]
===
```

## üß† Documentation Philosophy
**Think of documentation as a conversation with your future self:**
- What would you want to know if you saw this code for the first time?
- What mistakes might you make without proper context?
- What's the quickest path to understanding the entire system?
- Document not just WHAT the code does, but WHY it does it that way

This documentation system ensures that as projects grow, any new LLM can quickly understand the entire codebase, data flow, and system architecture.
