<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1024">
  <title>Flashcard Typing Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
  <!-- Shared wordpack logic (loading, decoding, shuffling, typing validation, debug tools) -->
  <script src="../wordpack-logic.js"></script>
  <!-- Shared game sounds (ding, buzz, card flip, button click, typing sounds) -->
  <script src="../game-sounds.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">
  <!-- Chinese font - loaded but only applied when Chinese modules are used -->
  <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC:wght@700&display=swap" rel="stylesheet">
  <style>
    /* =================================================================
       DESIGN SYSTEM - Single source of truth for fonts, colors, textures
       ================================================================= */
    :root {
      /* ===========================================
         FONTS - Only 4 fonts used in entire project
         =========================================== */
      /* 1. Handwriting font - main card text (target words) */
      --font-card: 'IM Fell English', serif;

      /* 2. Monospace font - answer/back of card, tooltips */
      --font-answer: 'Courier New', monospace;

      /* 3. UI font - buttons, titles, labels, everything else */
      --font-ui: 'Cinzel', serif;

      /* 4. Chinese font - front card Chinese characters only */
      --font-chinese: 'LXGW WenKai TC', serif;

      /* ===========================================
         COLORS - Only 3 text colors used
         =========================================== */
      /* 1. Dark brown - main text on light backgrounds */
      --color-text-dark: #2C1810;

      /* 2. Off-white/cream - text on dark backgrounds (card counter, etc) */
      --color-text-light: #F5E6D3;

      /* 3. Gold - accent for titles and special elements */
      --color-text-gold: #E8D498;

      /* ===========================================
         TEXTURES - Paper and cardboard effects
         =========================================== */
      /* Paper texture (for cards) - 200x200 viewBox */
      --paper-texture: url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.5' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23noise)'/%3E%3C/svg%3E");
      --paper-texture-size: 200px 200px;

      /* Cardboard texture (for buttons) - Same 200x200 viewBox, 2x larger grain */
      --cardboard-texture: url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.5' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23noise)'/%3E%3C/svg%3E");
      --cardboard-texture-size: 400px 400px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(ellipse at center, #8B7355 0%, #5D4E37 50%, #3D2E1F 100%);
      font-family: var(--font-card);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      padding-top: 80px; /* Space for fixed header */
      color: var(--color-text-dark);
    }

    /* ============================================================
       KEY FEATURE: Fixed Page Header
       Core Objective: Keep mode buttons, title, and UI buttons
       always visible at the top of the page
       Key Behaviors:
         - Fixed position at top of viewport
         - Contains mode selector (left), title (center), UI buttons (right)
         - Always visible even when scrolling/fullscreen
       ============================================================ */
    .page-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 100;
      background: linear-gradient(180deg, rgba(61, 46, 31, 0.85) 0%, rgba(61, 46, 31, 0) 100%);
    }

    .header-buttons {
      display: flex;
      gap: 10px;
    }

    /* Remove focus outline from all interactive elements */
    button:focus,
    button:active,
    select:focus,
    input:focus,
    .mode-btn:focus,
    .mode-btn:active,
    .action-btn:focus,
    .action-btn:active,
    .nav-btn:focus,
    .nav-btn:active {
      outline: none !important;
    }

    /* Wordpack Selector */
    .selector-container {
      background: rgba(60, 46, 31, 0.6);
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      border: 1px solid rgba(139, 115, 85, 0.3);
    }

    .selector-container label {
      font-family: var(--font-ui);
      font-size: 1rem;
      font-weight: bold;
      margin-right: 10px;
      color: var(--color-text-gold);
    }

    #wordpack-select {
      font-family: var(--font-ui);
      font-size: 1rem;
      font-weight: bold;
      padding: 8px 15px;
      border: 1px solid rgba(139, 115, 85, 0.4);
      border-radius: 5px;
      background: rgba(45, 35, 25, 0.8);
      color: var(--color-text-gold);
      cursor: pointer;
      min-width: 200px;
    }

    #wordpack-select:focus {
      outline: none;
      border-color: #8B7355;
      box-shadow: 0 0 5px rgba(139, 115, 85, 0.3);
    }

    #wordpack-select option {
      background: #3D2E1F;
      color: var(--color-text-gold);
    }

    /* Wordpack Title - Warm gold with subtle texture */
    /* ============================================================
       KEY FEATURE: Page Title in Header
       Core Objective: Show context while keeping card as focal point
       Key Behaviors:
         - Visible but not overpowering
         - Centered in header bar
       ============================================================ */
    .wordpack-title {
      /* Bright gold gradient */
      background-image:
        var(--cardboard-texture),
        linear-gradient(180deg,
          #E8C252 0%,      /* Bright gold */
          #D4AF37 30%,     /* Classic gold */
          #C9A227 60%,     /* Medium gold */
          #A67C38 100%     /* Bronze gold */
        );
      background-blend-mode: overlay;
      background-size: var(--cardboard-texture-size), 100%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-family: var(--font-ui);
      font-size: 1.4rem;
      font-weight: 600;
      text-shadow:
        0 1px 2px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transition: opacity 0.3s ease;
      letter-spacing: 1.5px;
      filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.3));
      white-space: nowrap;
    }

    body.game-started .wordpack-title {
      opacity: 0.9;
    }

    /* Show wordpack title when menu is visible */
    body.showing-menu .wordpack-title {
      opacity: 0.9;
    }

    /* Card Counter Wrapper - fixed height prevents layout shift when stamp appears */
    .card-counter-wrapper {
      min-height: 2.5rem; /* Accommodate counter + stamp indicator */
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }

    /* Card Counter */
    .card-counter {
      color: var(--color-text-light);
      font-size: 1.2rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    body.game-started .card-counter {
      opacity: 1;
    }

    /* Show card counter when menu is visible */
    body.showing-menu .card-counter {
      opacity: 1;
    }

    /* Flashcard Container */
    .flashcard-container {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 8px;
    }

    /* Navigation Arrows - Flat Cardboard Style */
    .nav-btn {
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      color: var(--color-text-dark);
      font-size: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
      text-align: center;
      opacity: 0;
      pointer-events: none;
    }

    body.game-started .nav-btn {
      opacity: 1;
      pointer-events: auto;
    }

    /* Show nav buttons when menu is visible (flashcard mode UI) */
    body.showing-menu .nav-btn {
      opacity: 1;
      pointer-events: auto;
    }

    .nav-btn:hover {
      background-color: #9B8365;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #B09577 0%, #9B8365 30%, #8A7357 60%, #7B6550 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    .nav-btn:active {
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    /* Flashcard */
    .flashcard {
      width: 650px;
      height: 420px;
      position: relative;
      cursor: pointer;
      user-select: none;
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 12px;
      overflow: hidden; /* Clip content to border-radius */
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
      text-align: center;

      /* Old paper texture - using CSS variable for consistency */
      background:
        var(--paper-texture),
        linear-gradient(135deg, #F5E6D3 0%, #E8D5B7 30%, #DCC9A3 60%, #D4C4A8 100%);
      background-blend-mode: soft-light;
      background-size: var(--paper-texture-size), 100%;

      /* Use box-shadow for border to avoid corner radius gaps */
      box-shadow:
        0 10px 30px rgba(0,0,0,0.4),
        0 0 0 3px #A08567,
        0 0 0 1px rgba(139, 115, 85, 0.3),
        inset 0 0 50px rgba(139, 115, 85, 0.1);
    }

    .card-face::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(255,255,255,0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(101, 67, 33, 0.1) 0%, transparent 50%);
      border-radius: 12px;
      pointer-events: none;
    }

    /* Torn edge effect - front card only */
    .card-front::after {
      content: '';
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      bottom: 8px;
      border: 1px dashed rgba(139, 115, 85, 0.3);
      border-radius: 4px;
      pointer-events: none;
    }

    /* Subtle grid pattern - back card only */
    .card-back::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 19px, rgba(139, 115, 85, 0.08) 19px, rgba(139, 115, 85, 0.08) 20px),
        repeating-linear-gradient(90deg, transparent, transparent 19px, rgba(139, 115, 85, 0.08) 19px, rgba(139, 115, 85, 0.08) 20px);
      border-radius: 12px;
      pointer-events: none;
      opacity: 0.7;
    }

    /* Random weathering overlay */
    .card-weathering {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 12px;
      pointer-events: none;
      z-index: 4;
      opacity: 0.6;
    }

    .card-front {
      z-index: 2;
    }

    .card-back {
      z-index: 1;
      background:
        var(--paper-texture),
        /* Lighter, whiter back card for distinction */
        radial-gradient(ellipse 70% 60% at 30% 35%, rgba(255, 250, 245, 0.3) 0%, transparent 70%),
        radial-gradient(ellipse 60% 55% at 70% 65%, rgba(250, 245, 240, 0.2) 0%, transparent 65%),
        linear-gradient(135deg, #FFFEF9 0%, #F8F5F0 30%, #F0EDE8 60%, #EAE7E2 100%);
      background-blend-mode: soft-light;
      background-size: var(--paper-texture-size), 100%, 100%, 100%;
    }

    /* Reduce edge weathering on back card for distinction */
    .card-back::before {
      opacity: 0.3;
    }

    .flashcard.flipped .card-front {
      z-index: 1;
      opacity: 0;
    }

    .flashcard.flipped .card-back {
      z-index: 2;
      opacity: 1;
    }

    .card-back {
      opacity: 0;
    }

    .card-label {
      font-family: var(--font-ui);
      font-size: 1.1rem;
      color: #8B7355;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 5;
      white-space: nowrap;
    }

    .card-word {
      font-size: 4rem;
      color: var(--color-text-dark);
      line-height: 1.2;
      font-style: italic;
      position: relative;
      z-index: 5;
      text-align: center;
      max-width: 90%;
      word-break: normal;
      overflow-wrap: break-word;
      hyphens: none;
    }

    /* Chinese font for front card - LXGW WenKai TC Bold (only when in chinese-mode) */
    body.chinese-mode .card-front .card-word {
      font-family: var(--font-chinese);
      font-weight: 700;
      font-style: normal;
    }

    /* Sound Button (pronounce - bottom right) */
    .sound-btn {
      position: absolute;
      bottom: 25px;
      right: 25px;
      background: rgba(139, 115, 85, 0.2);
      border: 3px solid rgba(160, 133, 103, 0.5);
      color: var(--color-text-dark);
      width: 55px;
      height: 55px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      line-height: 1;
      text-align: center;
      z-index: 10;
      opacity: 0;
      pointer-events: none;
    }

    .flashcard.game-started .sound-btn {
      opacity: 1;
      pointer-events: auto;
    }

    .sound-btn:hover {
      background: rgba(139, 115, 85, 0.4);
    }

    /* Peek Button (flip/peek at back - top right) - HIDDEN, moved to bottom right */
    .peek-btn {
      display: none !important; /* Hidden - peek button moved to bottom right as action button */
    }

    .peek-btn:hover {
      background: rgba(139, 115, 85, 0.4);
    }

    .peek-btn:active {
      background: rgba(139, 115, 85, 0.6);
    }

    /* Mic Button - HIDDEN, moved to card-controls below card */
    .mic-btn {
      display: none !important; /* Hidden - mic button moved to control bar */
    }

    /* Mic button listening state - applied to control-btn when recording */
    .control-btn.listening {
      background: rgba(180, 60, 60, 0.4) !important;
      border-color: #B43C3C !important;
      animation: pulse-mic 1s infinite;
    }

    @keyframes pulse-mic {
      0%, 100% { box-shadow: 0 0 0 0 rgba(180, 60, 60, 0.4); }
      50% { box-shadow: 0 0 0 10px rgba(180, 60, 60, 0); }
    }

    /* Pronunciation Feedback Overlay */
    .pronunciation-feedback {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .pronunciation-feedback.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .feedback-score {
      font-family: var(--font-ui);
      font-size: 3.5rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .feedback-score.excellent {
      color: #4ADE80;
    }

    .feedback-score.good {
      color: #A3E635;
    }

    .feedback-score.okay {
      color: #FACC15;
    }

    .feedback-score.poor {
      color: #F87171;
    }

    .feedback-message {
      font-size: 1.3rem;
      color: var(--color-text-light);
      margin-bottom: 8px;
    }

    .feedback-heard {
      font-size: 1.5rem;
      color: var(--color-text-gold);
      font-style: italic;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .feedback-close {
      background: rgba(139, 115, 85, 0.4);
      border: 1px solid #8B7355;
      color: var(--color-text-gold);
      padding: 8px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-family: var(--font-ui);
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .feedback-close:hover {
      background: rgba(139, 115, 85, 0.6);
    }

    /* Unsupported browser message */
    .mic-unsupported {
      display: none;
    }

    /* Setup Card - Front (Settings) */
    .setup-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        var(--paper-texture),
        linear-gradient(135deg, #F5E6D3 0%, #E8D5B7 30%, #DCC9A3 60%, #D4C4A8 100%);
      background-blend-mode: soft-light;
      background-size: var(--paper-texture-size), 100%;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px;
      z-index: 30;
      transition: opacity 0.4s ease;

      /* Match card styling */
      box-shadow:
        0 10px 30px rgba(0,0,0,0.4),
        0 0 0 1px rgba(139, 115, 85, 0.3),
        inset 0 0 50px rgba(139, 115, 85, 0.1);
      border: 3px solid #A08567;
    }

    .setup-overlay::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(255,255,255,0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(101, 67, 33, 0.1) 0%, transparent 50%);
      border-radius: 10px;
      pointer-events: none;
    }

    .setup-overlay::after {
      content: '';
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      bottom: 8px;
      border: 1px dashed rgba(139, 115, 85, 0.3);
      border-radius: 4px;
      pointer-events: none;
    }

    .setup-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* Setup Card - Back (How To) - Matches card-back styling */
    .setup-help {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        var(--paper-texture),
        /* Lighter, whiter back card for distinction - matches card-back */
        radial-gradient(ellipse 70% 60% at 30% 35%, rgba(255, 250, 245, 0.3) 0%, transparent 70%),
        radial-gradient(ellipse 60% 55% at 70% 65%, rgba(250, 245, 240, 0.2) 0%, transparent 65%),
        linear-gradient(135deg, #FFFEF9 0%, #F8F5F0 30%, #F0EDE8 60%, #EAE7E2 100%);
      background-blend-mode: soft-light;
      background-size: var(--paper-texture-size), 100%, 100%, 100%;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      padding: 30px;
      z-index: 29;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      overflow-y: auto;

      /* Match card styling */
      box-shadow:
        0 10px 30px rgba(0,0,0,0.4),
        0 0 0 3px #A08567,
        0 0 0 1px rgba(139, 115, 85, 0.3),
        inset 0 0 50px rgba(139, 115, 85, 0.1);
    }

    /* Edge weathering - reduced opacity like card-back */
    .setup-help::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(255,255,255,0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(101, 67, 33, 0.1) 0%, transparent 50%);
      border-radius: 12px;
      pointer-events: none;
      opacity: 0.3;
    }

    /* Subtle grid pattern - matches card-back */
    .setup-help::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image:
        repeating-linear-gradient(0deg, transparent, transparent 19px, rgba(139, 115, 85, 0.08) 19px, rgba(139, 115, 85, 0.08) 20px),
        repeating-linear-gradient(90deg, transparent, transparent 19px, rgba(139, 115, 85, 0.08) 19px, rgba(139, 115, 85, 0.08) 20px);
      border-radius: 12px;
      pointer-events: none;
      opacity: 0.7;
    }

    .flashcard.setup-flipped .setup-overlay {
      opacity: 0;
      pointer-events: none;
      z-index: 29;
    }

    .flashcard.setup-flipped .setup-help {
      opacity: 1;
      pointer-events: auto;
      z-index: 30;
    }

    .flashcard.game-started .setup-overlay,
    .flashcard.game-started .setup-help {
      opacity: 0;
      pointer-events: none;
      z-index: -1;
    }

    .setup-title {
      font-family: var(--font-ui);
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--color-text-dark);
      margin-bottom: 25px;
      letter-spacing: 2px;
      position: relative;
      z-index: 5;
    }

    .setup-row {
      display: flex;
      gap: 20px;
      justify-content: center;
      align-items: flex-start;
      margin-bottom: 15px;
      width: 100%;
      position: relative;
      z-index: 5;
    }

    .setup-field {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 15px;
      width: 100%;
      max-width: 280px;
      position: relative;
      z-index: 5;
    }

    .setup-row .setup-field {
      margin-bottom: 0;
      flex: 1;
    }

    .setup-field label {
      font-family: var(--font-card);
      font-size: 0.95rem;
      color: var(--color-text-dark);
      margin-bottom: 6px;
    }

    .setup-field select {
      font-family: var(--font-card);
      font-size: 1rem;
      padding: 10px 15px;
      border-radius: 6px;
      /* Paper card styling - matches card-face */
      background:
        var(--paper-texture),
        linear-gradient(135deg, #F5E6D3 0%, #E8D5B7 30%, #DCC9A3 60%, #D4C4A8 100%);
      background-blend-mode: soft-light;
      background-size: var(--paper-texture-size), 100%;
      color: var(--color-text-dark);
      cursor: pointer;
      width: 100%;
      text-align: left;
      text-align-last: left;
      /* Custom dropdown arrow */
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image:
        var(--paper-texture),
        linear-gradient(135deg, #F5E6D3 0%, #E8D5B7 30%, #DCC9A3 60%, #D4C4A8 100%),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%232C1810' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: repeat, no-repeat, no-repeat;
      background-position: 0 0, 0 0, calc(100% - 12px) center;
      background-size: var(--paper-texture-size), 100%, 12px;
      /* Box shadow for border and inner glow like card-face */
      box-shadow:
        0 2px 8px rgba(0,0,0,0.2),
        0 0 0 2px #A08567,
        inset 0 0 20px rgba(139, 115, 85, 0.1);
      border: none;
    }

    .setup-field select:focus {
      outline: none;
      box-shadow:
        0 2px 8px rgba(0,0,0,0.3),
        0 0 0 2px #8B7355,
        inset 0 0 20px rgba(139, 115, 85, 0.15);
    }

    .setup-field select option {
      background: #F5E6D3;
      color: var(--color-text-dark);
      text-align: left;
    }

    /* Setup flip button */
    .setup-flip-btn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      border: 2px solid rgba(139, 115, 85, 0.5);
      background: rgba(60, 46, 31, 0.6);
      color: var(--color-text-gold);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      z-index: 10;
    }

    .setup-flip-btn:hover {
      background: rgba(139, 115, 85, 0.8);
    }

    /* Help content styling - matches card-back with Courier font */
    .help-content {
      color: var(--color-text-dark);
      line-height: 1.7;
      position: relative;
      z-index: 5;
      font-size: 0.9rem;
      font-family: var(--font-answer);
    }

    .help-content h3 {
      font-family: var(--font-answer);
      font-size: 1rem;
      color: var(--color-text-dark);
      margin: 12px 0 6px;
      font-weight: bold;
    }

    .help-content p {
      margin-bottom: 8px;
    }

    .help-content ul {
      margin-left: 18px;
      margin-bottom: 12px;
    }

    .help-content li {
      margin-bottom: 4px;
    }

    .setup-start-btn {
      font-family: var(--font-ui);
      font-size: 1.1rem;
      font-weight: bold;
      padding: 12px 30px;
      margin-top: 15px;
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      border-radius: 8px;
      color: var(--color-text-dark);
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: 1px;
      position: relative;
      z-index: 5;
    }

    .setup-start-btn:hover:not(:disabled) {
      background-color: #9B8365;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #B09577 0%, #9B8365 30%, #8A7357 60%, #7B6550 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    .setup-start-btn:disabled {
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border-color: #4A3828;
      color: var(--color-text-dark);
      cursor: not-allowed;
      opacity: 0.45;
    }

    /* Hide card buttons when setup is visible - handled by opacity rules above */

    /* Hide card content when setup is visible (but NOT when showing menu/starting card) */
    .flashcard:not(.game-started):not(.showing-menu) .card-word {
      opacity: 0;
    }

    .flashcard:not(.game-started):not(.showing-menu) .card-label {
      opacity: 0;
    }

    /* Ensure menu card content is always visible */
    .flashcard.showing-menu .card-word {
      opacity: 1 !important;
    }

    /* Speed Controls in Menu */
    .speed-controls-menu {
      display: flex;
      gap: 8px;
      width: 100%;
    }

    .speed-btn {
      flex: 1;
      padding: 10px 8px;
      border-radius: 6px;
      border: 3px solid rgba(74, 56, 40, 0.6);
      /* Cardboard texture - inactive state (darker, recessed) */
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      color: var(--color-text-dark);
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: var(--font-ui);
      font-size: 1.2rem;
      text-align: center;
      opacity: 0.6;
    }

    .speed-btn:hover {
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      opacity: 0.8;
    }

    .speed-btn.active {
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border-color: rgba(74, 56, 40, 0.8);
      opacity: 1;
    }

    /* Speed buttons on starting card (menu) - round like mode buttons */
    .speed-btn-start, .menu-speed-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      /* Inactive: darker, more recessed (like mode-btn) */
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border-color: #4A3828;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
      color: var(--color-text-dark);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.45; /* Very low opacity for inactive to blend into background */
    }

    .speed-btn-start:hover, .menu-speed-btn:hover {
      background-color: #9B8365;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #B09577 0%, #9B8365 30%, #8A7357 60%, #7B6550 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      opacity: 0.7; /* Medium opacity on hover */
    }

    .speed-btn-start.active, .menu-speed-btn.active {
      /* Active: lighter, more prominent (like mode-btn.active) */
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border-color: rgba(74, 56, 40, 0.6);
      box-shadow: none;
      opacity: 1;
    }

    /* ============================================
       CARD CONTROL BAR - Below the flashcard
       ============================================ */
    .card-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 25px; /* Increased spacing between buttons */
      margin-top: 0;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    body.game-started .card-controls {
      opacity: 1;
      pointer-events: auto;
    }

    body.showing-menu .card-controls {
      opacity: 0;
      pointer-events: none;
    }

    /* Control buttons - cardboard style like nav buttons */
    .control-btn {
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      color: var(--color-text-dark);
      width: 55px;
      height: 55px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      line-height: 1;
      text-align: center;
      position: relative;
    }

    .control-btn:hover {
      background-color: #9B8365;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #B09577 0%, #9B8365 30%, #8A7357 60%, #7B6550 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    .control-btn:active {
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    /* Control button tooltips now use .btn-tooltip elements (see BUTTON TOOLTIPS section below) */
    /* This allows HTML content with styled buttons/keys */

    /* Separator between button groups */
    .control-separator {
      width: 2px;
      height: 35px;
      background: rgba(139, 115, 85, 0.4);
      border-radius: 1px;
      margin: 0 5px;
    }

    /* Top Corner Buttons - Flat Cardboard Style (in page header) */
    .top-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      color: var(--color-text-dark);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      line-height: 1;
      text-align: center;
      font-family: var(--font-ui);
      font-weight: 600;
    }

    .top-btn:hover {
      background-color: #9B8365;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #B09577 0%, #9B8365 30%, #8A7357 60%, #7B6550 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    .top-btn:active {
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    .reset-top-btn {
      opacity: 0;
      pointer-events: none;
    }

    body.game-started .reset-top-btn {
      opacity: 1;
      pointer-events: auto;
    }

    /* Show reset button when menu is visible */
    body.showing-menu .reset-top-btn {
      opacity: 1;
      pointer-events: auto;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    /* Modal Card */
    .modal-card {
      width: 90%;
      max-width: 450px;
      max-height: 80vh;
      overflow-y: auto;
      border-radius: 12px;
      padding: 30px;
      position: relative;
      background: 
        url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.5' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"),
        linear-gradient(135deg, #F5E6D3 0%, #E8D5B7 30%, #DCC9A3 60%, #D4C4A8 100%);
      background-blend-mode: soft-light;
      box-shadow: 
        0 10px 30px rgba(0,0,0,0.5),
        0 0 0 1px rgba(139, 115, 85, 0.3),
        inset 0 0 50px rgba(139, 115, 85, 0.1);
      border: 3px solid #A08567;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .modal-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(255,255,255,0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(101, 67, 33, 0.1) 0%, transparent 50%);
      border-radius: 10px;
      pointer-events: none;
    }

    .modal-card::after {
      content: '';
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      bottom: 8px;
      border: 1px dashed rgba(139, 115, 85, 0.3);
      border-radius: 4px;
      pointer-events: none;
    }

    .modal-overlay.visible .modal-card {
      transform: scale(1);
    }

    .modal-title {
      font-family: var(--font-ui);
      font-size: 1.5rem;
      color: var(--color-text-dark);
      margin-bottom: 20px;
      text-align: center;
      letter-spacing: 2px;
      position: relative;
      z-index: 5;
    }

    .modal-content {
      color: var(--color-text-dark);
      line-height: 1.7;
      position: relative;
      z-index: 5;
    }

    .modal-content h3 {
      font-family: var(--font-ui);
      font-size: 1.1rem;
      color: var(--color-text-dark);
      margin: 15px 0 8px;
    }

    .modal-content p {
      margin-bottom: 10px;
    }

    .modal-content ul {
      margin-left: 20px;
      margin-bottom: 15px;
    }

    .modal-content li {
      margin-bottom: 5px;
    }

    .modal-close-btn {
      display: block;
      margin: 20px auto 0;
      padding: 10px 25px;
      font-family: var(--font-ui);
      font-size: 1rem;
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      border-radius: 6px;
      color: var(--color-text-light);
      cursor: pointer;
      transition: all 0.2s ease;
      text-shadow: 0 1px 2px rgba(0,0,0,0.4);
      position: relative;
      z-index: 5;
    }

    .modal-close-btn:hover {
      background-color: #8A7357;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #9B8365 0%, #8A7357 30%, #7B6550 60%, #6D5E47 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
    }

    /* Menu Modal Specific */
    .menu-field {
      margin-bottom: 18px;
    }

    .menu-field label {
      display: block;
      font-family: var(--font-card);
      font-size: 0.95rem;
      color: var(--color-text-dark);
      margin-bottom: 6px;
    }

    .menu-field select {
      font-family: var(--font-card);
      font-size: 1rem;
      padding: 10px 15px;
      border-radius: 6px;
      /* Cardstock ivory with dot texture and dark edge burn */
      background-color: #f8f6f1;
      color: #5d4e37;
      cursor: pointer;
      width: 100%;
      /* Custom dropdown arrow */
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image:
        /* Dark edge burn/vignette */
        radial-gradient(ellipse at center, transparent 50%, rgba(139, 115, 85, 0.08) 80%, rgba(100, 75, 50, 0.15) 100%),
        /* Fine dot pattern */
        radial-gradient(circle, rgba(0,0,0,0.045) 0.5px, transparent 0.5px),
        /* Dropdown arrow */
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235d4e37' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat, repeat, no-repeat;
      background-position: 0 0, 0 0, calc(100% - 12px) center;
      background-size: 100%, 4px 4px, 12px;
      /* Border matching card style with subtle inner shadow */
      box-shadow:
        0 2px 8px rgba(0,0,0,0.15),
        0 0 0 2px #A08567,
        inset 0 0 15px rgba(100, 75, 50, 0.08);
      border: none;
    }

    .menu-field select:hover {
      box-shadow:
        0 2px 8px rgba(0,0,0,0.2),
        0 0 0 2px #8B7355,
        inset 0 0 18px rgba(100, 75, 50, 0.1);
    }

    .menu-field select:focus {
      outline: none;
      box-shadow:
        0 2px 8px rgba(0,0,0,0.25),
        0 0 0 2px #8B7355,
        inset 0 0 20px rgba(100, 75, 50, 0.12);
    }

    .menu-field select option {
      background: #f8f6f1;
      color: #5d4e37;
      padding: 8px;
    }

    /* Empty State */
    .empty-state {
      color: var(--color-text-light);
      font-size: 1.3rem;
      text-align: center;
      padding: 50px;
    }

    /* Loading State */
    .loading {
      color: var(--color-text-light);
      font-size: 1.2rem;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Shared stamp styling - used by card stamps and deck change indicator */
    .stamp-base {
      font-family: 'Courier New', Courier, monospace; /* Typewriter/stamp font */
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 2px;
      border: 3px solid;
      border-radius: 8px; /* More rounded corners */
      mix-blend-mode: multiply; /* Blends ink into content beneath */
      text-align: center;
      line-height: 1.3;
    }

    /* Simple stamp overlays - realistic rubber stamp effect */
    .card-stamp {
      position: absolute;
      top: 28%; /* Higher on card - top half, shows off the effect */
      left: 50%;
      transform: translate(-50%, -50%) rotate(-12deg);
      font-size: 1.6rem; /* Bigger to show off the cool effect */
      padding: 14px 28px;
      opacity: 0;
      pointer-events: none;
      z-index: 100;
      transition: opacity 0.2s ease;
      /* Uneven border like a real rubber stamp */
      border-width: 3px 4px 3px 3px;
      border-style: solid;
    }

    .removed-stamp {
      color: transparent;
      border-color: rgba(56, 142, 60, 0.85);
      -webkit-text-stroke: 1.5px rgba(56, 142, 60, 0.85);
      text-stroke: 1.5px rgba(56, 142, 60, 0.85);
      /* No background - transparent like real stamp */
    }

    .added-stamp {
      color: transparent;
      border-color: rgba(211, 47, 47, 0.85);
      -webkit-text-stroke: 1.5px rgba(211, 47, 47, 0.85);
      text-stroke: 1.5px rgba(211, 47, 47, 0.85);
      /* No background - transparent like real stamp */
    }

    .card-stamp.visible {
      opacity: 1;
    }

    /* Mode Selector - in page header */
    .mode-selector {
      display: flex;
      gap: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    body.game-started .mode-selector {
      opacity: 1;
      pointer-events: auto;
    }

    /* Show mode selector when menu is visible */
    body.showing-menu .mode-selector {
      opacity: 1;
      pointer-events: auto;
    }

    .mode-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      /* Inactive: darker, more recessed (old active style) */
      background-color: #7A6347;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #8B7355 0%, #7A6347 30%, #6B5540 60%, #5D4E37 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border-color: #4A3828;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
      color: var(--color-text-dark);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      line-height: 1;
      opacity: 0.45; /* Very low opacity for inactive to blend into background */
    }

    .mode-btn:hover {
      background-color: #9B8365;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #B09577 0%, #9B8365 30%, #8A7357 60%, #7B6550 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      /* No scale transform - buttons should not grow on hover */
      opacity: 0.7; /* Medium opacity on hover */
    }

    .mode-btn.active {
      /* Active: lighter, more prominent (old default style) */
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border: 3px solid rgba(74, 56, 40, 0.6);
      box-shadow: none; /* No inset shadow - more prominent */
      opacity: 1; /* Full opacity for active */
    }

    /* Typing mode display (listening and writing) */
    .typing-display {
      font-size: 4rem;
      color: var(--color-text-dark);
      font-family: var(--font-card);
      font-style: italic;
      letter-spacing: 4px;
      position: relative;
      z-index: 5;
      text-align: center;
      word-spacing: 20px;
      word-break: keep-all;
      white-space: normal;
      overflow-wrap: break-word;
    }

    /* In Chinese mode, typing display uses Courier New (typing pinyin) */
    .chinese-mode .typing-display {
      font-family: var(--font-answer);
      font-style: normal;
    }

    .typing-char {
      display: inline-block;
      min-width: 0.6em;
      text-align: center;
      transition: color 0.2s ease;
    }

    /* In Chinese mode, typing chars use Courier New (typed pinyin) */
    .chinese-mode .typing-display .typing-char {
      font-family: var(--font-answer) !important;
      font-style: normal !important;
    }

    .typing-char.wrong {
      color: #D32F2F;
    }

    .typing-space {
      display: inline-block;
      width: 0.8em;
    }

    /* Translation text (native language) */
    .translation-text {
      font-size: 3rem;
      color: var(--color-text-dark);
      font-family: var(--font-answer);
      font-style: normal;
    }

    /* =============================================== */
    /* CUSTOM TOOLTIPS - Hover Explanations */
    /* =============================================== */

    .tooltip-container {
      position: relative;
      display: inline-block;
    }

    .tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      z-index: 300;
      /* Fine fancy paper with subtle dot pattern */
      background-color: #f8f6f1;
      background-image:
        /* Subtle edge burn/vignette - reduced for smaller card */
        radial-gradient(ellipse at center, transparent 60%, rgba(139, 115, 85, 0.06) 90%, rgba(100, 75, 50, 0.1) 100%),
        /* Fine dot pattern for fancy paper texture - slightly sharper */
        radial-gradient(circle, rgba(0,0,0,0.045) 0.5px, transparent 0.5px);
      background-size: 100% 100%, 4px 4px;
      color: var(--color-text-dark);
      padding: 10px 14px;
      border-radius: 8px;
      overflow: hidden;
      /* Border and shadow matching card-face style */
      box-shadow:
        0 4px 16px rgba(0,0,0,0.3),
        0 0 0 3px #A08567,
        inset 0 0 12px rgba(139, 115, 85, 0.06),
        inset 0 0 25px rgba(100, 75, 50, 0.03);
      font-size: 1rem;
      line-height: 1.4;
      white-space: nowrap;
      pointer-events: none;
      transition: opacity 0.2s ease, visibility 0.2s ease;
      font-family: var(--font-answer);
    }

    /* Position tooltip below mode buttons */
    .mode-btn .tooltip {
      top: calc(100% + 6px);
      left: 50%;
      transform: translateX(-50%);
    }

    /* Position tooltip above flashcard */
    .flashcard .tooltip {
      bottom: calc(100% + 15px);
      left: 50%;
      transform: translateX(-50%);
      max-width: 400px;
      white-space: normal;
      text-align: center;
    }

    /* Show tooltip on hover */
    .tooltip-container:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }

    /* Arrow removed - using simple div style instead of speech bubble */

    .tooltip strong {
      /* Mode title - centered, LARGER, bold */
      display: block;
      text-align: center;
      color: var(--color-text-dark);
      font-weight: bold;
      font-size: 1.3rem;
      margin-bottom: 2px;
      position: relative;
      z-index: 2;
      font-family: var(--font-answer);
    }

    /* Bold steps - numbered list in tooltips */
    .tooltip b {
      color: var(--color-text-dark);
      font-weight: bold;
      position: relative;
      z-index: 2;
      display: inline;
      font-size: 1rem;
      line-height: 1.8;
      font-family: var(--font-answer);
    }

    .tooltip em {
      /* Instructions text - SAME COLOR as everything else */
      color: var(--color-text-dark);
      font-style: normal;
      position: relative;
      z-index: 2;
      display: block;
      margin-top: 2px;
      font-size: 0.9rem;
      line-height: 1.5;
      font-family: var(--font-answer);
    }

    /* Bold action words within em (CLICK, PRESS, HOLD, TYPE) */
    .tooltip em b {
      color: var(--color-text-dark);
      font-weight: bold;
      text-transform: uppercase;
      font-family: var(--font-answer);
    }

    /* Make all tooltip content appear above grid */
    .tooltip > * {
      position: relative;
      z-index: 2;
    }

    /* Visual button representations in tooltips */
    .tooltip-btn {
      display: inline-block;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border: 2px solid rgba(74, 56, 40, 0.6);
      color: var(--color-text-dark);
      font-size: 0.75rem;
      line-height: 20px;
      text-align: center;
      vertical-align: middle;
      margin: 0 2px;
    }

    .tooltip-key {
      display: inline-block;
      min-width: 28px;
      padding: 2px 6px;
      border-radius: 4px;
      background-color: #8B7355;
      background-image:
        var(--cardboard-texture),
        linear-gradient(135deg, #A08567 0%, #8B7355 30%, #7A6347 60%, #6B5540 100%);
      background-blend-mode: soft-light;
      background-size: var(--cardboard-texture-size), 100%;
      border: 2px solid rgba(74, 56, 40, 0.6);
      color: var(--color-text-dark);
      font-size: 0.7rem;
      font-weight: bold;
      line-height: 1.2;
      text-align: center;
      vertical-align: middle;
      margin: 0 2px;
      font-family: var(--font-ui);
    }

    /* Tooltip instructions container - minimal gap from title */
    .tooltip-instructions {
      margin-top: 4px;
      font-size: 0.9rem;
      line-height: 1.6;
      text-align: left;
    }

    /* =============================================== */
    /* BUTTON TOOLTIPS - HTML-enabled hover tooltips */
    /* =============================================== */
    /* These are actual DOM elements (not ::after pseudo) so they can render HTML */

    .btn-tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      /* Fancy paper with subtle fiber/dot pattern */
      background:
        /* Fine noise texture for paper feel */
        url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E"),
        /* Subtle vignette for depth */
        radial-gradient(ellipse at center, transparent 40%, rgba(139, 115, 85, 0.06) 100%),
        /* Soft cream parchment gradient */
        linear-gradient(145deg, #FDF8F0 0%, #F5EDE0 25%, #EDE4D3 50%, #E8DCC8 75%, #E0D4BE 100%);
      background-size: 150px 150px, 100% 100%, 100% 100%;
      color: var(--color-text-dark);
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow:
        0 4px 16px rgba(0,0,0,0.25),
        0 0 0 1px rgba(139, 115, 85, 0.4),
        inset 0 1px 0 rgba(255,255,255,0.5),
        inset 0 -1px 0 rgba(139, 115, 85, 0.1);
      font-size: 0.85rem;
      white-space: nowrap;
      pointer-events: none;
      /* 1 second delay before showing */
      transition: opacity 0.2s ease 0s, visibility 0.2s ease 0s;
      font-family: var(--font-answer);
      font-weight: normal;
      z-index: 100;
    }

    .control-btn:hover .btn-tooltip {
      visibility: visible;
      opacity: 1;
      /* 1 second delay - user must hold hover to see tooltip */
      transition-delay: 1s;
    }

    /* Arrow removed - using simple div style instead of speech bubble */

    /* =================================================================
       CHINESE DISPLAY OPTIONS - Character + Pinyin Coupling
       Design: Yellow/gold warning-style box to draw attention
       Shows only when native language is Chinese
       ================================================================= */
    /* =================================================================
       CHINESE CHARACTER + PINYIN COUPLED DISPLAY
       Core Objective: Render each Chinese character with its pinyin directly below

       Structure:
         .chinese-coupled (flex container, horizontal)
            .char-group (flex column for each character)
                .chinese-char (the character)
                .pinyin (pinyin syllable)

       This ensures char/pinyin are NEVER separated during display
       ================================================================= */
    .chinese-coupled {
      display: inline-flex;
      gap: 4px;
      align-items: flex-end;
      justify-content: center;
      flex-wrap: wrap;
    }

    .char-group {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .chinese-char {
      font-size: 1em;
      line-height: 1.2;
    }

    .pinyin {
      font-size: 0.6em;
      color: #666;
      line-height: 1;
      font-family: var(--font-answer);
    }

    /* Adjust for card display - larger characters */
    .card-word .chinese-coupled .chinese-char {
      font-size: 1em;
    }

    .card-word .chinese-coupled .pinyin {
      font-size: 0.4em;
      color: var(--color-text-dark);
    }

    /* Debug UI removed - now dynamically generated by wordpack-logic.js */
    /* Debug table has no CSS styling - plain HTML only */
    /* Toggle debug mode with: Ctrl + Shift + Alt + D + E + B + U + G */

    /* Difficulty Selector - appears under title */
    /* Wrapper for title and difficulty - centered in header */
    .title-difficulty-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .difficulty-selector {
      display: flex;
      gap: 12px;
      align-items: center;
      font-family: var(--font-ui);
      font-size: 0.75rem;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    /* Show difficulty selector when game started or menu visible */
    body.game-started .difficulty-selector,
    body.showing-menu .difficulty-selector {
      opacity: 0.7;
    }

    .difficulty-selector label {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      color: rgba(232, 196, 82, 0.8); /* Subtle gold to match title */
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .difficulty-selector label:hover {
      color: #E8C252; /* Brighter gold on hover */
      transform: scale(1.05);
    }

    .difficulty-selector input[type="radio"] {
      cursor: pointer;
      accent-color: #D4AF37; /* Gold accent for radio buttons */
    }
  </style>
</head>
<body>
  <!-- Fixed Page Header: Mode selector (left) + Title (center) + UI buttons (right) -->
  <div class="page-header">
    <!-- Mode Selector -->
    <!-- Tooltips are populated dynamically via initializeTooltips() using TOOLTIP_MESSAGES -->
    <div class="mode-selector">
      <span class="tooltip-container">
        <button class="mode-btn active" id="mode-flashcard" data-mode="flashcard"></button>
        <span class="tooltip" id="tooltip-reading"></span>
      </span>
      <span class="tooltip-container">
        <button class="mode-btn" id="mode-spelling" data-mode="spelling"></button>
        <span class="tooltip" id="tooltip-listening"></span>
      </span>
      <span class="tooltip-container">
        <button class="mode-btn" id="mode-pronunciation" data-mode="pronunciation"></button>
        <span class="tooltip" id="tooltip-speaking"></span>
      </span>
      <span class="tooltip-container">
        <button class="mode-btn" id="mode-translation" data-mode="translation"></button>
        <span class="tooltip" id="tooltip-writing"></span>
      </span>
    </div>

    <!-- Title and Difficulty - centered together -->
    <div class="title-difficulty-wrapper">
      <div class="wordpack-title" id="wordpack-title">Flashcard Typing Game</div>
      <div class="difficulty-selector" id="difficulty-selector">
        <label><input type="radio" name="difficulty" value="easy"> Easy</label>
        <label><input type="radio" name="difficulty" value="medium"> Medium</label>
        <label><input type="radio" name="difficulty" value="hard" checked> Hard</label>
      </div>
    </div>

    <!-- Top Buttons -->
    <div class="header-buttons">
      <button class="top-btn reset-top-btn" id="reset-btn" aria-label="Reset deck"></button>
      <button class="top-btn fullscreen-btn" id="fullscreen-btn" aria-label="Toggle fullscreen"></button>
      <button class="top-btn menu-btn" id="menu-btn" aria-label="Menu"></button>
    </div>
  </div>

  <!-- Fixed-height wrapper prevents card from shifting when stamp indicator appears -->
  <div class="card-counter-wrapper">
    <div class="card-counter" id="card-counter">Choose Wordpack to Begin Studying</div>
  </div>

  <div class="flashcard-container">
    <button class="nav-btn" id="prev-btn" aria-label="Previous card"></button>

    <div class="flashcard" id="flashcard">
      <div class="card-face card-front">
        <div class="card-weathering" id="weathering-front"></div>
        <!-- Wrong answer indicators (positioned at card corners) -->
        <div id="wrong-letters-front" style="position: absolute; top: 12px; left: 12px; font-size: 2em; font-family: var(--font-card); font-style: italic; font-weight: bold; color: #D32F2F; z-index: 20; max-width: 550px; line-height: 0.9; text-align: left;"></div>
        <div id="wrong-count-front" style="position: absolute; top: 12px; right: 12px; font-size: 2em; font-family: var(--font-card); font-style: italic; font-weight: bold; color: #D32F2F; z-index: 20;"></div>
        <span class="card-word" id="spanish-word"></span>
        <button class="mic-btn" id="mic-btn-front" aria-label="Practice pronunciation" data-tooltip="Record Pronunciation"></button>
        <button class="peek-btn" id="peek-btn-front" aria-label="Peek at back"></button>
        <div class="pronunciation-feedback" id="feedback-front">
          <div class="feedback-score" id="score-front">0%</div>
          <div class="feedback-message" id="message-front">Try again!</div>
          <div class="feedback-heard" id="heard-front">Heard: ""</div>
          <button class="feedback-close" id="close-front">Got it</button>
        </div>
      </div>
      <div class="card-face card-back">
        <div class="card-weathering" id="weathering-back"></div>
        <span class="card-word" id="english-word"></span>
        <button class="mic-btn" id="mic-btn-back" aria-label="Practice pronunciation" data-tooltip="Record Pronunciation"></button>
        <div class="pronunciation-feedback" id="feedback-back">
          <div class="feedback-score" id="score-back">0%</div>
          <div class="feedback-message" id="message-back">Try again!</div>
          <div class="feedback-heard" id="heard-back">Heard: ""</div>
          <button class="feedback-close" id="close-back">Got it</button>
        </div>
      </div>

      <!-- Stamp overlays for visual feedback -->
      <div class="stamp-base card-stamp removed-stamp" id="removed-stamp">Great Job!<br>Card Removed</div>
      <div class="stamp-base card-stamp added-stamp" id="added-stamp">Keep Learning!<br>Practice Added</div>
    </div>

    <button class="nav-btn" id="next-btn" aria-label="Next card"></button>
  </div>

  <!-- Card Controls - Below the flashcard -->
  <div class="card-controls" id="card-controls">
    <!-- Left group: Got It / Don't Got It (flashcard mode only) -->
    <button class="control-btn" id="got-it-btn" data-tooltip=""></button>
    <button class="control-btn" id="confused-btn" data-tooltip=""></button>
    <!-- Mic button (pronunciation mode only) - before separator so divider shows in pronunciation mode -->
    <button class="control-btn" id="mic-btn-control" data-tooltip="" style="display: none;"></button>
    <div class="control-separator" id="control-separator"></div>
    <!-- Right group: Pronounce / Peek (all modes) -->
    <button class="control-btn" id="pronounce-btn" data-tooltip=""></button>
    <button class="control-btn" id="peek-btn" data-tooltip=""></button>
  </div>

  <script type="module" src="FlashcardTypingGame.js"></script>

  <!-- Debug UI is now generated dynamically by wordpack-logic.js via initializeDebugUI() -->
  <!-- Toggle debug mode with hotkey: Ctrl + ` (backtick key, next to "1") -->
</body>
</html>
