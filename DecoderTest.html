<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wordpack Data Structure Debugger</title>

  <!--
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                                                                              â•‘
    â•‘   ğŸ® LANGUAGE LEARNING GAME - REFERENCE TEMPLATE IMPLEMENTATION ğŸ®           â•‘
    â•‘                                                                              â•‘
    â•‘   This file serves as the CANONICAL REFERENCE for all language learning     â•‘
    â•‘   games in this project. It demonstrates 100% compliance with our design    â•‘
    â•‘   principles and should be used as a template for building new games.       â•‘
    â•‘                                                                              â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ============================================================
    TABLE OF CONTENTS
    ============================================================
    1. DESIGN PRINCIPLES OVERVIEW
    2. DATA STRUCTURE ARCHITECTURE
    3. STATE PERSISTENCE (localStorage)
    4. DRY (Don't Repeat Yourself) PATTERNS
    5. KEY FEATURES DOCUMENTATION
    6. COLUMN MAPPING BY LANGUAGE
    7. HOW TO USE THIS TEMPLATE

    ============================================================
    1. DESIGN PRINCIPLES OVERVIEW
    ============================================================

    This project follows strict design principles to ensure maintainability,
    consistency, and ease of development. ALL games must follow these rules:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PRINCIPLE 1: KEY FEATURES ARE SACRED                                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - Every important feature MUST have a KEY FEATURE comment block        â”‚
    â”‚ - KEY FEATURES document: Core Objective + Key Behaviors                â”‚
    â”‚ - KEY FEATURES can NEVER be removed without explicit user request      â”‚
    â”‚ - Code can change, but the FEATURE must be preserved                   â”‚
    â”‚                                                                        â”‚
    â”‚ FORMAT:                                                                â”‚
    â”‚   // ============================================================     â”‚
    â”‚   // KEY FEATURE: [High-level description]                            â”‚
    â”‚   // Core Objective: [Why this feature exists]                        â”‚
    â”‚   // Key Behaviors:                                                   â”‚
    â”‚   //   - [Behavior 1 that must be preserved]                          â”‚
    â”‚   //   - [Behavior 2 that must be preserved]                          â”‚
    â”‚   // ============================================================     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PRINCIPLE 2: DRY (Don't Repeat Yourself) - ENCAPSULATION               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - NEVER copy-paste the same code in multiple places                    â”‚
    â”‚ - If something happens together, put it in ONE function                â”‚
    â”‚ - Ask: "If I needed to change this, how many places would I update?"   â”‚
    â”‚ - If answer > 1, you need to encapsulate                               â”‚
    â”‚                                                                        â”‚
    â”‚ EXAMPLES IN THIS FILE:                                                 â”‚
    â”‚   - autoSelectFirstActAndPack(): Called from 2 places                  â”‚
    â”‚   - setupModeCheckboxes(): Config-driven, not 3 separate functions     â”‚
    â”‚   - resetListeningState(): Used in 3 event handlers                    â”‚
    â”‚   - normalizeCharForTyping(): Single function for accent removal       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PRINCIPLE 3: STATE PERSISTENCE (localStorage) - MANDATORY              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - ALL user-configurable settings MUST be saved to localStorage         â”‚
    â”‚ - On page load, restore saved state (or use sensible defaults)         â”‚
    â”‚ - User should return to EXACTLY where they left off                    â”‚
    â”‚ - Validate saved values against current valid options                  â”‚
    â”‚                                                                        â”‚
    â”‚ WHAT MUST BE SAVED:                                                    â”‚
    â”‚   - Language selection (Spanish, Chinese, English)                     â”‚
    â”‚   - Act selection                                                      â”‚
    â”‚   - Pack selection                                                     â”‚
    â”‚   - Native language ("I speak") selection                              â”‚
    â”‚   - Mode toggles (multiple choice, typing, pronunciation)              â”‚
    â”‚   - Any other user preference                                          â”‚
    â”‚                                                                        â”‚
    â”‚ WHEN TO SAVE:                                                          â”‚
    â”‚   - On ANY menu/setting change                                         â”‚
    â”‚   - Call saveState() immediately after state change                    â”‚
    â”‚                                                                        â”‚
    â”‚ VALIDATION RULE:                                                       â”‚
    â”‚   - Always validate saved values against current valid options         â”‚
    â”‚   - If saved value is invalid, fall back to default                    â”‚
    â”‚   - This prevents bugs when options change between versions            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PRINCIPLE 4: SINGLE SOURCE OF TRUTH (Configuration Objects)            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - All configuration lives in JavaScript objects, NOT hardcoded HTML    â”‚
    â”‚ - Dropdowns are EMPTY in HTML, populated from config                   â”‚
    â”‚ - If you delete the config, NOTHING should work                        â”‚
    â”‚                                                                        â”‚
    â”‚ IN THIS FILE:                                                          â”‚
    â”‚   - LANGUAGE_CONFIG: All module paths, columns, native languages       â”‚
    â”‚   - VALID_MODES: List of valid mode options for validation             â”‚
    â”‚   - HTML dropdowns: Empty <select></select> elements                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ============================================================
    2. DATA STRUCTURE ARCHITECTURE
    ============================================================

    Our language learning data follows a hierarchical structure:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         DATA HIERARCHY                                  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                        â”‚
    â”‚   LANGUAGE (Spanish, Chinese, English)                                 â”‚
    â”‚       â”‚                                                                â”‚
    â”‚       â””â”€â”€ ACT (Learning Stage - e.g., "Foundation", "Daily Life")      â”‚
    â”‚             â”‚                                                          â”‚
    â”‚             â””â”€â”€ WORDPACK (Vocabulary Set - e.g., "Greetings")          â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚                   â”œâ”€â”€ META (Pack metadata: number, titles)             â”‚
    â”‚                   â”‚                                                    â”‚
    â”‚                   â””â”€â”€ WORDS (Array of word arrays)                     â”‚
    â”‚                         â”‚                                              â”‚
    â”‚                         â””â”€â”€ WORD (Array of translations by column)     â”‚
    â”‚                                                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    OBFUSCATED MODULE STRUCTURE (NEW - with baseWords/exampleWords separation):
    Each .js module exports a dictionary of wordpacks:

    {
      "p{act}_{pack}_{name}": {
        "meta": {
          "wordpack": 1,                    // Pack number (integer)
          "english": "Greetings & Goodbyes", // Pack title in English
          "chinese": "é—®å€™è¯­",                // Pack title in Chinese
          "spanish": "Saludos y Despedidas", // Pack title in Spanish
          ... // Other language translations as supported
        },
        "baseWords": [
          ["base1_col0", "base1_col1", "base1_col2", ...],  // Core vocabulary
          ["base2_col0", "base2_col1", "base2_col2", ...],
          ["base3_col0", "base3_col1", "base3_col2", ...]
        ],
        "exampleWords": [
          ["example1_col0", "example1_col1", "example1_col2", ...],  // Usage examples
          ["example2_col0", "example2_col1", "example2_col2", ...],
          ["example3_col0", "example3_col1", "example3_col2", ...]
        ]
      },
      "p{act}_{pack}_{name}": { ... },
      ...
    }

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    ğŸ¯ CRITICAL ARCHITECTURE DESIGN ğŸ¯                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                          â”‚
    â”‚  WHY WE SEPARATE baseWords AND exampleWords:                            â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                                                                          â”‚
    â”‚  Learning Pedagogy: Core vocabulary (base words) should be learned      â”‚
    â”‚  BEFORE contextual examples. This separation allows:                    â”‚
    â”‚                                                                          â”‚
    â”‚  1. BASE WORDS FIRST: Essential vocabulary without context              â”‚
    â”‚     Example: ["hola", "adiÃ³s", "gracias"]                              â”‚
    â”‚                                                                          â”‚
    â”‚  2. EXAMPLES SECOND: Real-world usage with context                      â”‚
    â”‚     Example: ["hola amigo", "adiÃ³s mi amor", "muchas gracias"]         â”‚
    â”‚                                                                          â”‚
    â”‚  3. CONTROLLED RANDOMIZATION:                                           â”‚
    â”‚     - Shuffle baseWords internally â†’ random order within base words    â”‚
    â”‚     - Shuffle exampleWords internally â†’ random order within examples   â”‚
    â”‚     - Concatenate: [shuffled_base] + [shuffled_examples]               â”‚
    â”‚     - Result: Base vocabulary ALWAYS appears before examples,           â”‚
    â”‚       but both sections are randomized for variety                      â”‚
    â”‚                                                                          â”‚
    â”‚  This prevents learners from seeing "hola amigo" before learning "hola" â”‚
    â”‚  while still providing randomization within each category.              â”‚
    â”‚                                                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    CRITICAL: Column 0 is ALWAYS the target language being learned!

    ============================================================
    3. STATE PERSISTENCE (localStorage) - IMPLEMENTATION
    ============================================================

    Every game MUST implement these functions:

    const STORAGE_KEY = 'uniqueGameNameState';  // Unique per game

    function saveState() {
      const stateToSave = {
        language: state.currentLanguage,
        act: state.currentAct,
        pack: state.currentPack,
        nativeLanguage: state.currentNativeLanguage,
        // ... all other user settings
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(stateToSave));
    }

    function loadState() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        return saved ? JSON.parse(saved) : null;
      } catch (e) {
        console.error('Failed to load state:', e);
        return null;
      }
    }

    function restoreSavedState() {
      const saved = loadState();
      if (!saved) return;

      // ALWAYS validate before restoring!
      if (saved.language && VALID_LANGUAGES.includes(saved.language)) {
        state.currentLanguage = saved.language;
      }
      // ... validate and restore other settings
    }

    ============================================================
    4. DRY PATTERNS - EXAMPLES IN THIS FILE
    ============================================================

    PATTERN 1: Encapsulated Helper Functions
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    PROBLEM: Same 5 lines of code in 2+ places
    SOLUTION: Extract to named function, call from both places

    Example: autoSelectFirstActAndPack()
    - Used in: initialize(), setupLanguageRadioButtons()
    - Benefit: Change logic in ONE place

    PATTERN 2: Configuration-Driven Loops
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    PROBLEM: 3 separate functions doing almost the same thing
    SOLUTION: One function with config array

    Example: setupModeCheckboxes()
    - Config: [{ id, stateKey, statesToClear }, ...]
    - One loop handles all checkboxes identically
    - Add new checkbox = add to config array

    PATTERN 3: Callback Parameters
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    PROBLEM: Same action with different follow-up
    SOLUTION: Function takes callback parameter

    Example: showSuccessStamp(onComplete)
    - Stamp + sound + delay always happen together
    - What happens AFTER varies
    - Pass the variation as callback

    ============================================================
    5. KEY FEATURES IN THIS FILE
    ============================================================

    Search for "KEY FEATURE:" to find all documented features:

    1. Global State Management - Single source of truth for UI state
    2. State Persistence (localStorage) - Save/restore user settings
    3. Module Decoding - 3-layer obfuscation (base64 + zlib + reverse)
    4. Auto-Select First Act/Pack - DRY encapsulated function
    5. Language Selection - Switch between target languages
    6. Mode Checkboxes - DRY config-driven setup
    7. Speech Recognition - Pronunciation practice with scoring
    8. Multiple Choice Generation - Act-wide pool, duplicate filtering
    9. Typing Practice - Character-by-character with accent tolerance
    10. Vocabulary Table Display - Multi-mode rendering
    11. Flashcard Mode - ANTI-DECOUPLING DEMONSTRATION (front/back always linked)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PRINCIPLE 5: ANTI-DECOUPLING (Critical for Flashcard Games)            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Related data must be stored as properties of the SAME object,          â”‚
    â”‚ never in separate arrays that could get out of sync.                   â”‚
    â”‚                                                                        â”‚
    â”‚ âŒ WRONG (Decoupled - leads to bugs):                                  â”‚
    â”‚    const fronts = ["hola", "adiÃ³s"];                                   â”‚
    â”‚    const backs = ["hello", "goodbye"];                                 â”‚
    â”‚    // Problem: Arrays can get out of sync!                             â”‚
    â”‚                                                                        â”‚
    â”‚ âœ… RIGHT (Anti-decoupled - always safe):                               â”‚
    â”‚    const cards = [                                                     â”‚
    â”‚      { front: "hola", back: "hello" },                                 â”‚
    â”‚      { front: "adiÃ³s", back: "goodbye" }                               â”‚
    â”‚    ];                                                                  â”‚
    â”‚    // Benefit: front and back are ALWAYS linked!                       â”‚
    â”‚                                                                        â”‚
    â”‚ See "Flashcard Mode" for a live demonstration.                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ============================================================
    6. COLUMN MAPPING BY LANGUAGE
    ============================================================

    SPANISH (5 columns):
      [0] = Spanish (TARGET - language being learned)
      [1] = English
      [2] = Chinese
      [3] = Pinyin
      [4] = Portuguese

    CHINESE (12 columns):
      [0] = Chinese (TARGET - language being learned)
      [1] = Pinyin
      [2] = English
      [3] = Spanish
      [4] = French
      [5] = Portuguese
      [6] = Vietnamese
      [7] = Thai
      [8] = Khmer
      [9] = Indonesian
      [10] = Malay
      [11] = Filipino

    ENGLISH (5 columns):
      [0] = English (TARGET - language being learned)
      [1] = Chinese
      [2] = Pinyin
      [3] = Spanish
      [4] = Portuguese

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CRITICAL: CHINESE + PINYIN INSEPARABILITY                               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Notice that ALL three languages include Chinese AND Pinyin columns!    â”‚
    â”‚                                                                        â”‚
    â”‚ WHY: Chinese uses logograms (characters don't encode pronunciation)    â”‚
    â”‚      â†’ Pinyin MUST accompany Chinese whenever it appears               â”‚
    â”‚                                                                        â”‚
    â”‚ This applies whether Chinese is:                                       â”‚
    â”‚   - The target language (ChineseWords CSVs)                           â”‚
    â”‚   - A translation option (SpanishWords, EnglishWords CSVs)            â”‚
    â”‚                                                                        â”‚
    â”‚ EDGE CASE: Latin Abbreviations in Chinese Text                         â”‚
    â”‚ When Chinese contains Latin (ATM, DNA, WhatsApp, etc.):               â”‚
    â”‚   - Latin sequence â†’ same in pinyin (case insensitive)                â”‚
    â”‚   - Chinese characters â†’ pinyin syllables (1:1 mapping)               â”‚
    â”‚                                                                        â”‚
    â”‚ Examples:                                                              â”‚
    â”‚   Chinese: ATMæœº      â†’ Pinyin: ATM jÄ«                                â”‚
    â”‚   Chinese: DNAæµ‹è¯•     â†’ Pinyin: DNA cÃ¨ shÃ¬                            â”‚
    â”‚   Chinese: WhatsAppæ¶ˆæ¯ â†’ Pinyin: WhatsApp xiÄo xÄ«                    â”‚
    â”‚   Chinese: Tæ¤        â†’ Pinyin: T xÃ¹                                  â”‚
    â”‚                                                                        â”‚
    â”‚ Use "Show Edge Cases" checkbox below to filter for these examples.    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ============================================================
    7. HOW TO USE THIS TEMPLATE
    ============================================================

    To create a new game based on this template:

    1. Copy this file as your starting point
    2. Change STORAGE_KEY to unique value for your game
    3. Keep all KEY FEATURE implementations
    4. Keep all DRY helper functions
    5. Keep localStorage save/restore pattern
    6. Add your game-specific features with KEY FEATURE comments
    7. Follow the same documentation style

    CHECKLIST FOR NEW GAMES:
    â–¡ Unique STORAGE_KEY defined
    â–¡ saveState() called on every setting change
    â–¡ loadState() called during initialization
    â–¡ Saved values validated against valid options
    â–¡ All KEY FEATURES documented with comment blocks
    â–¡ No copy-pasted code (use encapsulated functions)
    â–¡ Configuration objects as single source of truth
    â–¡ Empty HTML dropdowns, populated from JS config

    ============================================================
  -->

  <!--
    ============================================================
    PAKO.JS DEPENDENCY - Required for decompressing obfuscated modules
    ============================================================
    Our obfuscated modules use zlib compression (via pako library).
    This CDN script provides the pako.inflate() function for decompression.
  -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
  <!-- Shared wordpack logic (loading, decoding, shuffling, typing validation) -->
  <script src="./wordpack-logic.js"></script>

  <style>
    /* Fixed Header */
    body {
      margin: 0;
      padding-top: 180px; /* Space for fixed header */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .decoder-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(61, 46, 31, 0.95) 0%, rgba(61, 46, 31, 0.92) 100%);
      padding: 15px 20px;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      color: #fff;
    }

    .decoder-header h1 {
      margin: 0 0 8px 0;
      font-size: 1.4rem;
      color: #E8C252;
    }

    .header-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .control-group label {
      font-size: 0.75rem;
      color: #D4AF37;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .control-group select {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #666;
      background: rgba(255,255,255,0.95);
      font-size: 0.9rem;
    }

    .mode-selector {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    .mode-selector label {
      cursor: pointer;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
      color: rgba(232,196,82,0.9);
      transition: color 0.2s;
    }

    .mode-selector label:hover {
      color: #E8C252;
    }

    .mode-selector input[type="radio"] {
      accent-color: #D4AF37;
    }

    .content-container {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
  </style>
</head>
<body>

  <!-- Fixed Header with All Controls -->
  <div class="decoder-header">
    <h1>Wordpack Data Structure Debugger</h1>
    <div class="header-controls">
      <!-- Language Selection -->
      <div class="control-group">
        <label>Target Language</label>
        <div id="languageRadios" style="display: flex; gap: 10px; margin-top: 5px;">
          <label style="font-size: 0.85rem; color: #fff; text-transform: none;">
            <input type="radio" name="language" value="Spanish" checked> Spanish
          </label>
          <label style="font-size: 0.85rem; color: #fff; text-transform: none;">
            <input type="radio" name="language" value="Chinese"> Chinese
          </label>
          <label style="font-size: 0.85rem; color: #fff; text-transform: none;">
            <input type="radio" name="language" value="English"> English
          </label>
        </div>
      </div>

      <!-- Act Selection -->
      <div class="control-group">
        <label for="actSelect">Act</label>
        <select id="actSelect"></select>
      </div>

      <!-- Pack Selection -->
      <div class="control-group">
        <label for="packSelect">Wordpack</label>
        <select id="packSelect"></select>
      </div>

      <!-- Native Language -->
      <div class="control-group">
        <label for="nativeLanguageSelect">I Speak</label>
        <select id="nativeLanguageSelect"></select>
      </div>
    </div>

    <!-- Mode Selector (Radio Buttons) -->
    <div class="mode-selector">
      <label><input type="radio" name="viewMode" value="table" checked> Table</label>
      <label><input type="radio" name="viewMode" value="multipleChoice"> Multiple Choice</label>
      <label><input type="radio" name="viewMode" value="typing"> Typing</label>
      <label><input type="radio" name="viewMode" value="pronunciation"> Pronunciation</label>
      <label><input type="radio" name="viewMode" value="flashcard"> Flashcard</label>
    </div>
  </div>

  <!-- Content Container -->
  <div class="content-container">

  <!-- Vocabulary Table Section -->
  <h2>Vocabulary Table</h2>
  <p><strong>Pack Title:</strong> <span id="packTitle">Select a wordpack to view</span></p>

  <!--
    ============================================================
    VOCABULARY TABLE - With Optional Multiple Choice Mode
    ============================================================
    Displays the selected wordpack's vocabulary.

    BASIC MODE (Default):
    - 2 columns: Target language (column 0) and Native language (selected)

    MULTIPLE CHOICE MODE (Checkbox enabled):
    - 6 columns total:
      1. Target language (correct answer, column 0)
      2. Native language translation (column N)
      3-6. Four wrong answers (randomly selected from ENTIRE ACT, ~2,500 words)

    WRONG ANSWER POOL:
    Wrong answers are now pulled from ALL wordpacks in the current act,
    not just the current wordpack. This provides:
    - Greater variety (2,500 options vs 50)
    - Less predictable patterns
    - Better simulation of real game mechanics
    - Zero performance cost (all data already loaded in memory)

    DUPLICATE FILTERING:
    Uses normalized string comparison (lowercase, no spaces/symbols)
    to avoid showing essentially identical words:
    - "hola" vs "Hola" (case difference) - filtered
    - "hello friend" vs "hellofriend" (spacing) - filtered
    - "hello!" vs "hello" (punctuation) - filtered

    This demonstrates the CORE LOGIC for generating multiple choice questions
    used in language learning games. Different game mechanics require different
    numbers of choices:
    - Temple Run style: 3 choices (1 correct + 2 wrong)
    - Quiz games: 4 choices (1 correct + 3 wrong)
    - This demo: 6 choices (1 correct + 4 wrong) to show extensibility

    The algorithm works for ANY target language (Spanish, Chinese, English, etc.)
    and ANY future language packs we add to the system.

    NOTE: Mode selection is now in the fixed header above (radio buttons).
  -->

  <!--
    ============================================================
    EDGE CASES & MISMATCHES FILTER - Combined Filter
    ============================================================
    When enabled, filters the vocabulary table to show words with:

    1. EDGE CASES - Latin abbreviations/brand names in Chinese text:
       - ATMæœº â†’ ATM jÄ« (Latin block + Chinese character)
       - DNAæµ‹è¯• â†’ DNA cÃ¨ shÃ¬ (abbreviation + Chinese)
       - WhatsAppæ¶ˆæ¯ â†’ WhatsApp xiÄo xÄ« (brand name + Chinese)
       - Tæ¤ â†’ T xÃ¹ (single letter + Chinese)
       - la, los â†’ la, los (Spanish articles in Chinese column)

    2. PINYIN MISMATCHES - Words with "?" in pinyin (CSV data errors):
       - Character count doesn't match syllable count
       - Indicates validation failures that need fixing

    WHY THIS IS USEFUL:
    - See real examples of edge cases in the actual data
    - Identify pinyin errors that need surgical fixes
    - Verify edge cases are NOT validation errors (they're correct!)
    - Understand how Latin text mixes with Chinese in modern usage
  -->
  <p id="edgeCaseFilterContainer" style="display: none;">
    <label>
      <input type="checkbox" id="showEdgeCasesOnly">
      <strong>Show Edge Cases & Mismatches</strong> (Latin abbreviations + pinyin errors)
    </label>
  </p>

  <!--
    ============================================================
    FLASHCARD MODE CHECKBOX
    ============================================================
    When enabled, shows a simple flashcard interface demonstrating
    the CRITICAL anti-decoupling principle:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ANTI-DECOUPLING PRINCIPLE (CRITICAL FOR FLASHCARD GAMES)               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                        â”‚
    â”‚ âŒ WRONG WAY (Decoupled - leads to bugs):                              â”‚
    â”‚    const fronts = ["hola", "adiÃ³s", "gracias"];                        â”‚
    â”‚    const backs  = ["hello", "goodbye", "thank you"];                   â”‚
    â”‚    // Problem: If arrays get out of sync, flipping shows WRONG answer  â”‚
    â”‚    // Bug: fronts[2] might display backs[1] if something shifts        â”‚
    â”‚                                                                        â”‚
    â”‚ âœ… RIGHT WAY (Anti-decoupled - front/back ALWAYS linked):              â”‚
    â”‚    const cards = [                                                     â”‚
    â”‚      { front: "hola",    back: "hello" },      // Card 0               â”‚
    â”‚      { front: "adiÃ³s",   back: "goodbye" },    // Card 1               â”‚
    â”‚      { front: "gracias", back: "thank you" }   // Card 2               â”‚
    â”‚    ];                                                                  â”‚
    â”‚    // Benefit: cards[i].front and cards[i].back are ALWAYS paired      â”‚
    â”‚    // Shuffling reorders cards but NEVER breaks the link               â”‚
    â”‚                                                                        â”‚
    â”‚ WHY THIS MATTERS:                                                      â”‚
    â”‚   - Flipping a card ALWAYS shows the correct translation               â”‚
    â”‚   - Shuffling the deck doesn't break anything                          â”‚
    â”‚   - Adding/removing cards can't cause misalignment                     â”‚
    â”‚   - The card is ONE OBJECT, not two separate arrays                    â”‚
    â”‚                                                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    This mode demonstrates the principle with a minimal, no-CSS implementation.

    NOTE: Flashcard mode is now in the fixed header above (radio button).
  -->

  <!--
    ============================================================
    FLASHCARD DISPLAY AREA (Simple, No CSS)
    ============================================================
    This is intentionally unstyled to focus on the DATA STRUCTURE,
    not the visual presentation. The key teaching point is HOW
    front and back are stored as ONE object, not two arrays.
  -->
  <div id="flashcardArea" style="display: none; margin: 20px 0; padding: 20px; border: 2px solid #333; background: #f9f9f9;">
    <h3>Flashcard Demo (Anti-Decoupling Principle)</h3>
    <p><em>Front and back are properties of the SAME card object - they can never get out of sync.</em></p>

    <!-- Card display - simple border box -->
    <div id="flashcardDisplay" style="border: 3px solid #666; padding: 40px; margin: 20px 0; text-align: center; min-height: 150px; background: white; cursor: pointer;" onclick="window.flipCard()">
      <div id="flashcardContent" style="font-size: 24px;">Click to start</div>
      <div id="flashcardSide" style="font-size: 12px; color: #999; margin-top: 10px;">(click card to flip)</div>
    </div>

    <!-- Navigation buttons - plain HTML buttons -->
    <div style="text-align: center;">
      <button onclick="window.prevCard()" style="padding: 10px 20px; margin: 5px;">â† Previous</button>
      <button onclick="window.flipCard()" style="padding: 10px 20px; margin: 5px;">Flip Card</button>
      <button onclick="window.nextCard()" style="padding: 10px 20px; margin: 5px;">Next â†’</button>
      <button onclick="window.shuffleDeck()" style="padding: 10px 20px; margin: 5px;">ğŸ”€ Shuffle</button>
    </div>

    <!-- Card counter -->
    <p id="flashcardCounter" style="text-align: center; margin-top: 10px;">Card 0 of 0</p>

    <!-- Debug: Show current card object structure -->
    <details style="margin-top: 20px;">
      <summary style="cursor: pointer; font-weight: bold;">ğŸ” View Current Card Object (Anti-Decoupling Proof)</summary>
      <pre id="flashcardDebug" style="background: #eee; padding: 10px; overflow-x: auto; font-size: 12px;">
// No card loaded yet
      </pre>
      <p style="font-size: 12px; color: #666;">
        â†‘ Notice: <code>front</code> and <code>back</code> are properties of the SAME object.<br>
        They cannot get out of sync because they're not stored in separate arrays.
      </p>
    </details>
  </div>

  <table border="1" cellpadding="8" cellspacing="0">
    <thead>
      <tr id="tableHeaderRow">
        <th id="col1Header">I am learning</th>
        <th id="col2Header">I speak</th>
      </tr>
    </thead>
    <tbody id="vocabularyTable">
      <tr>
        <td colspan="2">Loading data...</td>
      </tr>
    </tbody>
  </table>

  <hr>

  <!--
    ============================================================
    DEBUG INFORMATION
    ============================================================
    Shows technical details about loaded data for debugging purposes.
  -->
  <h2>6. Debug Information</h2>
  <pre id="debugInfo">Initializing...</pre>

  <!--
    ============================================================
    JAVASCRIPT MODULE - Main Logic
    ============================================================
    This section contains all the JavaScript logic for:
    1. Decoding obfuscated modules (3-layer: base64 + zlib + string reversal)
    2. Loading language data automatically on page load
    3. Populating dropdowns dynamically
    4. Displaying vocabulary in 2-column table
    5. Handling user interactions (language/act/pack/native language changes)
  -->
  <script type="module">

    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘                                                                              â•‘
    // â•‘  âš ï¸  CRITICAL WARNING TO FUTURE LLMs: CODE REUSABILITY REQUIREMENTS  âš ï¸     â•‘
    // â•‘                                                                              â•‘
    // â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    // â•‘                                                                              â•‘
    // â•‘  ğŸ“‹ PRIMARY RULE: MOVE ALL REUSABLE CODE TO wordpack-logic.js               â•‘
    // â•‘                                                                              â•‘
    // â•‘  ONLY keep code in this file if you are 1000% CERTAIN it:                   â•‘
    // â•‘    1. Is specific to DecoderTest's unique UI/layout                          â•‘
    // â•‘    2. Cannot POSSIBLY be reused by ANY future language learning game         â•‘
    // â•‘    3. Directly manipulates DecoderTest-specific DOM elements                 â•‘
    // â•‘                                                                              â•‘
    // â•‘  ğŸš« DO NOT KEEP IN THIS FILE:                                                â•‘
    // â•‘    âŒ Shuffle algorithms (use shuffleArray from wordpack-logic.js)           â•‘
    // â•‘    âŒ Character normalization (use normalizeChar from wordpack-logic.js)     â•‘
    // â•‘    âŒ Levenshtein distance (use levenshteinDistance from wordpack-logic.js)  â•‘
    // â•‘    âŒ Chinese+Pinyin coupling (use coupleChineseWithPinyin from w-p-l.js)    â•‘
    // â•‘    âŒ String comparison (use normalizeString from wordpack-logic.js)         â•‘
    // â•‘    âŒ Multiple choice generation (use generateWrongAnswers from w-p-l.js)    â•‘
    // â•‘    âŒ State save/load (use saveState/loadState from wordpack-logic.js)       â•‘
    // â•‘    âŒ Module loading/decoding (use loadAct/decodeObfuscatedModule)           â•‘
    // â•‘    âŒ Typing validation (use findNextTypingPosition/checkTypingKey)          â•‘
    // â•‘    âŒ ANY function that could be used in multiple games                      â•‘
    // â•‘                                                                              â•‘
    // â•‘  âœ… OK TO KEEP IN THIS FILE:                                                 â•‘
    // â•‘    âœ“ displayVocabulary() - renders vocabulary table (DecoderTest-specific)  â•‘
    // â•‘    âœ“ setupChineseDisplayOptions() - checkbox UI (game-specific)             â•‘
    // â•‘    âœ“ updateChineseOptionsVisibility() - UI toggle (game-specific)           â•‘
    // â•‘    âœ“ Event handlers for DecoderTest-specific buttons/inputs                 â•‘
    // â•‘    âœ“ DOM manipulation specific to DecoderTest's HTML structure              â•‘
    // â•‘                                                                              â•‘
    // â•‘  ğŸ¯ THE GOAL: HUNDREDS OF FUTURE LANGUAGE LEARNING GAMES                     â•‘
    // â•‘                                                                              â•‘
    // â•‘  We are building wordpack-logic.js to contain ALL core logic that can be    â•‘
    // â•‘  reused across hundreds of future games. These games will have different:   â•‘
    // â•‘    - Visual layouts (flashcards, grids, runner games, puzzle games, etc.)   â•‘
    // â•‘    - UI interactions (click, swipe, drag, voice, typing, etc.)              â•‘
    // â•‘    - Game mechanics (timed, scored, lives, multiplayer, etc.)               â•‘
    // â•‘                                                                              â•‘
    // â•‘  But they ALL share the SAME core logic:                                    â•‘
    // â•‘    - Loading/decoding wordpack modules                                      â•‘
    // â•‘    - Shuffling arrays                                                       â•‘
    // â•‘    - Typing validation (accent-insensitive, space-handling)                 â•‘
    // â•‘    - Chinese character + pinyin coupling                                    â•‘
    // â•‘    - Multiple choice answer generation                                      â•‘
    // â•‘    - Pronunciation scoring (Levenshtein distance)                           â•‘
    // â•‘    - State persistence (save/load to localStorage)                          â•‘
    // â•‘                                                                              â•‘
    // â•‘  ğŸ” BEFORE WRITING ANY FUNCTION, ASK YOURSELF:                               â•‘
    // â•‘                                                                              â•‘
    // â•‘  "Could a Temple Run language game use this?"                               â•‘
    // â•‘  "Could a flashcard game use this?"                                         â•‘
    // â•‘  "Could a multiple choice quiz use this?"                                   â•‘
    // â•‘  "Could a typing race game use this?"                                       â•‘
    // â•‘                                                                              â•‘
    // â•‘  If YES to ANY â†’ MOVE IT TO wordpack-logic.js IMMEDIATELY!                   â•‘
    // â•‘  If NO to ALL â†’ Check if it manipulates DecoderTest-specific DOM            â•‘
    // â•‘    - If YES: Keep it here                                                   â•‘
    // â•‘    - If NO: You're wrong, move it to wordpack-logic.js anyway               â•‘
    // â•‘                                                                              â•‘
    // â•‘  ğŸ“– EXAMPLE DECISION TREE:                                                   â•‘
    // â•‘                                                                              â•‘
    // â•‘  Function: generateWrongAnswers()                                           â•‘
    // â•‘  Question: Could other games use multiple choice?                           â•‘
    // â•‘  Answer: YES (quiz games, runner games choosing lanes, etc.)                â•‘
    // â•‘  Decision: â¡ï¸  MOVE TO wordpack-logic.js                                     â•‘
    // â•‘                                                                              â•‘
    // â•‘  Function: displayVocabulary()                                              â•‘
    // â•‘  Question: Do other games display vocabulary in a table like DecoderTest?   â•‘
    // â•‘  Answer: NO (flashcards show one word, runner shows 3 lanes, etc.)          â•‘
    // â•‘  Decision: â¡ï¸  KEEP in DecoderTest.html                                      â•‘
    // â•‘                                                                              â•‘
    // â•‘  Function: normalizeCharForTyping()                                         â•‘
    // â•‘  Question: Do other games need accent-insensitive typing?                   â•‘
    // â•‘  Answer: YES (typing games, fill-in-blank games, etc.)                      â•‘
    // â•‘  Decision: â¡ï¸  ALREADY in wordpack-logic.js as normalizeChar()               â•‘
    // â•‘  Action: â¡ï¸  DELETE from this file, use normalizeChar() instead              â•‘
    // â•‘                                                                              â•‘
    // â•‘  âš¡ PERFORMANCE NOTE:                                                         â•‘
    // â•‘  Shared functions in wordpack-logic.js are loaded ONCE and cached by the    â•‘
    // â•‘  browser. This is MORE efficient than duplicating code in each game.        â•‘
    // â•‘                                                                              â•‘
    // â•‘  ğŸ”§ REFACTORING CHECKLIST:                                                   â•‘
    // â•‘                                                                              â•‘
    // â•‘  Before committing changes to this file:                                    â•‘
    // â•‘  â–¡  Searched for duplicate functions between this and other games           â•‘
    // â•‘  â–¡  Checked if any function could be reused (10/10 reusability score)       â•‘
    // â•‘  â–¡  Moved all 10/10 functions to wordpack-logic.js                          â•‘
    // â•‘  â–¡  Updated wordpack-logic.js module.exports to include new functions       â•‘
    // â•‘  â–¡  Verified no duplicate implementations (shuffle, normalize, etc.)        â•‘
    // â•‘  â–¡  Tested game still works after refactoring                               â•‘
    // â•‘                                                                              â•‘
    // â•‘  ğŸ“š DOCUMENTATION REQUIREMENT:                                               â•‘
    // â•‘  If you ADD a function to wordpack-logic.js, you MUST add documentation:    â•‘
    // â•‘    - JSDoc comment explaining what it does                                  â•‘
    // â•‘    - Parameters with types                                                  â•‘
    // â•‘    - Return value with type                                                 â•‘
    // â•‘    - Example usage                                                          â•‘
    // â•‘  See existing functions in wordpack-logic.js for the standard.              â•‘
    // â•‘                                                                              â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // ============================================================
    // KEY FEATURE: State Persistence (localStorage)
    // Core Objective: Save and restore ALL user settings across sessions
    // Key Behaviors:
    //   - Save state on EVERY setting change (language, act, pack, modes)
    //   - Restore state on page load with validation
    //   - Validate saved values against current valid options
    //   - Fall back to defaults if saved values are invalid
    // ============================================================

    /*
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ STORAGE_KEY - Unique identifier for this game's localStorage           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ IMPORTANT: Each game MUST have a unique STORAGE_KEY!                   â”‚
      â”‚                                                                        â”‚
      â”‚ When creating a new game from this template:                           â”‚
      â”‚   1. Change this value to something unique (e.g., 'myNewGameState')    â”‚
      â”‚   2. This prevents different games from overwriting each other's data  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    */
    const STORAGE_KEY = 'decoderTestState';

    /*
      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
      â•‘                                                                           â•‘
      â•‘  âš ï¸ IMPORTANT: MANY FUNCTIONS IN THIS FILE HAVE BEEN MOVED âš ï¸             â•‘
      â•‘                                                                           â•‘
      â•‘  The following highly-reusable functions (scores 7-10) have been         â•‘
      â•‘  moved to wordpack-logic.js for use across ALL future games:             â•‘
      â•‘                                                                           â•‘
      â•‘  SCORE 10 (Core functions - used in EVERY game):                         â•‘
      â•‘    â€¢ getAudioContext()           - Audio context creation                â•‘
      â•‘    â€¢ playTypingSound()           - Mechanical keyboard click sound       â•‘
      â•‘    â€¢ handleTypingInput()         - Typing validation logic               â•‘
      â•‘    â€¢ startListeningForPronunciation() - Speech recognition              â•‘
      â•‘                                                                           â•‘
      â•‘  SCORE 9 (Used in most games):                                           â•‘
      â•‘    â€¢ restoreSavedState()         - Validate and restore localStorage     â•‘
      â•‘    â€¢ loadLanguageData()          - Load act modules                      â•‘
      â•‘    â€¢ resetListeningState()       - Reset speech recognition state        â•‘
      â•‘    â€¢ initFlashcardDeck()         - Anti-decoupled flashcard deck         â•‘
      â•‘    â€¢ shuffleDeck()               - Fisher-Yates shuffle for flashcards   â•‘
      â•‘                                                                           â•‘
      â•‘  SCORE 8 (Common patterns):                                              â•‘
      â•‘    â€¢ validateAndFixState()       - Validate act/pack against loaded data â•‘
      â•‘    â€¢ flipCard()                  - Toggle flashcard front/back           â•‘
      â•‘    â€¢ nextCard()                  - Navigate to next flashcard            â•‘
      â•‘    â€¢ prevCard()                  - Navigate to previous flashcard        â•‘
      â•‘                                                                           â•‘
      â•‘  SCORE 7 (Could be useful):                                              â•‘
      â•‘    â€¢ autoSelectFirstActAndPack() - DRY helper for auto-selection         â•‘
      â•‘                                                                           â•‘
      â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â•‘
      â•‘                                                                           â•‘
      â•‘  ğŸ¯ FUTURE GAME DEVELOPERS: Use the wordpack-logic.js versions!          â•‘
      â•‘                                                                           â•‘
      â•‘  These functions still exist in DecoderTest.html for backwards           â•‘
      â•‘  compatibility, but NEW GAMES should import them from                    â•‘
      â•‘  wordpack-logic.js instead.                                              â•‘
      â•‘                                                                           â•‘
      â•‘  THE GOLDEN RULE:                                                        â•‘
      â•‘  "Could this function plausibly be used by ANY future language           â•‘
      â•‘  learning game?"                                                         â•‘
      â•‘    â€¢ If YES (score 7-10) â†’ Use/add to wordpack-logic.js                 â•‘
      â•‘    â€¢ If NO (score 1-6) â†’ Keep in your game file                         â•‘
      â•‘                                                                           â•‘
      â•‘  See wordpack-logic.js for extensive documentation and examples!         â•‘
      â•‘                                                                           â•‘
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    */

    /*
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ VALID OPTIONS - Used for validating saved state                        â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ These arrays define what values are acceptable for each setting.       â”‚
      â”‚ When restoring saved state, we check if the saved value is in these.   â”‚
      â”‚ If not, we fall back to the default value.                             â”‚
      â”‚                                                                        â”‚
      â”‚ WHY THIS MATTERS:                                                      â”‚
      â”‚ If you change valid options (e.g., add/remove a language), users with  â”‚
      â”‚ old saved state won't have invalid values restored.                    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    */
    const VALID_LANGUAGES = ['Spanish', 'Chinese', 'English'];

    // ============================================================
    // CONFIGURATION: Language Module Paths and Column Structures
    // ============================================================

    /*
      This configuration maps each target language to:
      1. Module file paths (obfuscated .js files for each act)
      2. Column structure (what each column index represents)
      3. Available native languages (for "I speak" dropdown)
    */
    const LANGUAGE_CONFIG = {
      'Spanish': {
        modules: [
          { act: 1, name: 'Foundation', path: './SpanishWords/Jsmodules-js/act1-foundation-js.js' },
          { act: 2, name: 'Building Blocks', path: './SpanishWords/Jsmodules-js/act2-building-blocks-js.js' },
          { act: 3, name: 'Daily Life', path: './SpanishWords/Jsmodules-js/act3-daily-life-js.js' },
          { act: 4, name: 'Expanding Expression', path: './SpanishWords/Jsmodules-js/act4-expanding-expression-js.js' },
          { act: 5, name: 'Intermediate Mastery', path: './SpanishWords/Jsmodules-js/act5-intermediate-mastery-js.js' },
          { act: 6, name: 'Advanced Constructs', path: './SpanishWords/Jsmodules-js/act6-advanced-constructs-js.js' },
          { act: 7, name: 'Mastery Fluency', path: './SpanishWords/Jsmodules-js/act7-mastery-fluency-js.js' }
        ],
        columns: ['Spanish', 'English', 'Chinese', 'Pinyin', 'Portuguese'],
        nativeLanguages: {
          'English': 1,
          'Chinese': 2,
          'Pinyin': 3,
          'Portuguese': 4
        }
      },
      'Chinese': {
        modules: [
          { act: 1, name: 'Foundation', path: './ChineseWords/Jsmodules-js/act1-foundation-js.js' },
          { act: 2, name: 'Development', path: './ChineseWords/Jsmodules-js/act2-development-js.js' },
          { act: 3, name: 'Expansion', path: './ChineseWords/Jsmodules-js/act3-expansion-js.js' },
          { act: 4, name: 'Mastery', path: './ChineseWords/Jsmodules-js/act4-mastery-js.js' },
          { act: 5, name: 'Refinement', path: './ChineseWords/Jsmodules-js/act5-refinement-js.js' }
        ],
        columns: ['Chinese', 'Pinyin', 'English', 'Spanish', 'French', 'Portuguese', 'Vietnamese', 'Thai', 'Khmer', 'Indonesian', 'Malay', 'Filipino'],
        nativeLanguages: {
          'English': 2,
          'Spanish': 3,
          'French': 4,
          'Portuguese': 5,
          'Vietnamese': 6,
          'Thai': 7,
          'Khmer': 8,
          'Indonesian': 9,
          'Malay': 10,
          'Filipino': 11
        }
      },
      'English': {
        modules: [
          { act: 1, name: 'Foundation', path: './EnglishWords/Jsmodules-js/act1-foundation-js.js' },
          { act: 2, name: 'Building Blocks', path: './EnglishWords/Jsmodules-js/act2-building-blocks-js.js' },
          { act: 3, name: 'Everyday Life', path: './EnglishWords/Jsmodules-js/act3-everyday-life-js.js' },
          { act: 4, name: 'Expanding Horizons', path: './EnglishWords/Jsmodules-js/act4-expanding-horizons-js.js' },
          { act: 5, name: 'Advanced Mastery', path: './EnglishWords/Jsmodules-js/act5-advanced-mastery-js.js' }
        ],
        columns: ['English', 'Chinese', 'Pinyin', 'Spanish', 'Portuguese'],
        nativeLanguages: {
          'Chinese': 1,
          'Pinyin': 2,
          'Spanish': 3,
          'Portuguese': 4
        }
      },
      'None': {
        modules: [],
        columns: [],
        nativeLanguages: {}
      }
    };

    // ============================================================
    // KEY FEATURE: Global State Management
    // Core Objective: Single source of truth for all UI state
    // Key Behaviors:
    //   - Tracks current language, act, pack selections
    //   - Tracks mode toggles (multiple choice, typing, pronunciation)
    //   - Per-word state for interactive modes (typing progress, scores)
    // ============================================================

    /*
      Global state object tracks:
      - currentLanguage: Which target language is selected
      - loadedData: Dictionary mapping act numbers to decoded wordpack data
      - currentAct: Currently selected act number
      - currentPack: Currently selected wordpack key
      - currentNativeLanguage: Column index for native language
      - multipleChoiceMode: Boolean flag for showing wrong answer columns
      - typingMode: Boolean flag for showing typing practice columns
      - typingStates: Map tracking typing state for each word (wordIndex -> state object)
      - pronunciationMode: Boolean flag for showing pronunciation practice columns
      - pronunciationStates: Map tracking pronunciation state for each word (wordIndex -> { score, heard, attempted })
      - showChineseChars: Boolean flag for showing Chinese characters (global)
      - showPinyin: Boolean flag for showing pinyin under characters (global)
    */
    let state = {
      currentLanguage: 'Spanish',  // Default language
      loadedData: {},               // { actNumber: { packKey: {meta, words}, ... } }
      loadedActMeta: {},            // { actNumber: { actName, translations, wordColumns, ... } } - from __actMeta
      currentAct: null,
      currentPack: null,
      currentNativeLanguage: 1,     // Default to English column (index 1 for Spanish)
      multipleChoiceMode: false,    // Default to basic 2-column mode
      typingMode: false,            // Default to typing mode off
      typingStates: new Map(),      // Per-word typing state { typed: Set(), wrongLetters: [], wrongCount: 0 }
      pronunciationMode: false,     // Default to pronunciation mode off
      pronunciationStates: new Map(), // Per-word pronunciation state { score: null, heard: '', attempted: false }
      flashcardMode: false,         // Default to flashcard mode off
      flashcardDeck: [],            // Anti-decoupled deck: [{front, back, id}, ...] - NEVER separate arrays!
      flashcardIndex: 0,            // Current card index in flashcardDeck
      flashcardShowingFront: true,  // true = showing front, false = showing back
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // CHINESE DISPLAY OPTIONS (Global - affects ALL Chinese text rendering)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      showChineseChars: true,       // Show Chinese characters (æ±‰å­—) - default ON
      showPinyin: true              // Show pinyin under each character - default ON
    };

    // ============================================================
    // STATE PERSISTENCE FUNCTIONS (localStorage)
    // ============================================================

    /*
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ saveState() - Save ALL user-configurable settings to localStorage      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ WHEN TO CALL:                                                          â”‚
      â”‚   - On language change                                                 â”‚
      â”‚   - On act change                                                      â”‚
      â”‚   - On pack change                                                     â”‚
      â”‚   - On native language change                                          â”‚
      â”‚   - On any mode toggle (multiple choice, typing, pronunciation)        â”‚
      â”‚                                                                        â”‚
      â”‚ WHAT WE SAVE:                                                          â”‚
      â”‚   - currentLanguage: Target language being learned                     â”‚
      â”‚   - currentAct: Selected act number                                    â”‚
      â”‚   - currentPack: Selected pack key                                     â”‚
      â”‚   - currentNativeLanguage: Column index for "I speak" language         â”‚
      â”‚   - multipleChoiceMode: Boolean for wrong answers mode                 â”‚
      â”‚   - typingMode: Boolean for typing practice mode                       â”‚
      â”‚   - pronunciationMode: Boolean for speech recognition mode             â”‚
      â”‚                                                                        â”‚
      â”‚ WHAT WE DON'T SAVE:                                                    â”‚
      â”‚   - loadedData: Too large, will be reloaded on page load               â”‚
      â”‚   - typingStates: Per-session progress, not persistent                 â”‚
      â”‚   - pronunciationStates: Per-session progress, not persistent          â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    */
    // ============================================================
    // DELETED: saveState()
    // ============================================================
    // USE INSTEAD: window.saveState(stateObject, storageKey) from wordpack-logic.js
    //
    // Migration:
    //   OLD: saveState()
    //   NEW: window.saveState(state, STORAGE_KEY)
    //
    // The shared function is more generic and accepts the state object
    // and storage key as parameters.
    // ============================================================

    // ============================================================
    // DELETED: loadState()
    // ============================================================
    // USE INSTEAD: window.loadState(storageKey) from wordpack-logic.js
    //
    // Migration:
    //   OLD: const saved = loadState()
    //   NEW: const saved = window.loadState(STORAGE_KEY)
    //
    // The shared function accepts the storage key as a parameter.
    // ============================================================



    // ============================================================
    // SPEECH RECOGNITION SETUP
    // ============================================================

    /*
      Web Speech API setup for pronunciation recognition.

      BROWSER SUPPORT:
      - Chrome: Full support (webkitSpeechRecognition)
      - Edge: Full support (SpeechRecognition)
      - Firefox: Partial support
      - Safari: Limited support

      CONFIGURATION:
      - continuous: false (single utterance recognition)
      - interimResults: false (only final results)
      - maxAlternatives: 5 (check multiple interpretations for best match)
      - lang: Dynamic based on target language
    */
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition = null;
    let isListening = false;
    let currentListeningWordIndex = null;  // Track which word is being recorded

    // Language code mapping for speech recognition
    const SPEECH_LANG_CODES = {
      'Spanish': 'es-ES',
      'Chinese': 'zh-CN',
      'English': 'en-US'
    };

    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.maxAlternatives = 5;
      // Language will be set dynamically based on currentLanguage
    }

    // ============================================================
    // KEY FEATURE: Module Decoding (3-Layer Obfuscation)
    // Core Objective: Load and decode compressed wordpack data
    // Key Behaviors:
    //   - Base64 decode â†’ Zlib decompress â†’ String reverse
    //   - Returns parsed JSON with all wordpacks in an act
    //   - Single function handles all decoding logic (DRY)
    // ============================================================

    /*
      Our wordpack modules are obfuscated using 3 layers of protection:
      1. Base64 encoding - Allows safe transport as JavaScript string
      2. Zlib compression (via pako) - Reduces file size by ~60%
      3. String reversal - Simple salt to prevent casual JSON parsing

      This function reverses all 3 steps to extract the original JSON data.

      INPUT: URL path to obfuscated module (e.g., './SpanishWords/Jsmodules-js/act1-foundation-js.js')
      OUTPUT: JavaScript object containing all wordpacks in that act

      EXAMPLE OUTPUT STRUCTURE:
      {
        "p1_1_greetings__goodbyes": {
          meta: { wordpack: 1, english: "Greetings & Goodbyes", ... },
          words: [
            ["hola amigo", "hello friend (masculine)", "ä½ å¥½æœ‹å‹", "nÇ hÇo pÃ©ngyÇ’u", "olÃ¡ amigo"],
            ["hola amiga", "hello friend (feminine)", "ä½ å¥½æœ‹å‹", "nÇ hÇo pÃ©ngyÇ’u", "olÃ¡ amiga"],
            ...
          ]
        },
        "p1_2_another_pack": { ... },
        ...
      }
    */
    // ============================================================
    // DELETED: decodeObfuscatedModule()
    // ============================================================
    // USE INSTEAD: window.decodeObfuscatedModule(url) from wordpack-logic.js
    //
    // Migration:
    //   OLD: const data = await decodeObfuscatedModule(url)
    //   NEW: const data = await window.decodeObfuscatedModule(url)
    //
    // This is a CRITICAL shared function (reusability 10/10) used by ALL games.
    // Exact duplicate - same 3-layer decode logic (base64 + zlib + reverse).
    // ============================================================

    // ============================================================
    // ğŸ¯ ARCHITECTURE: Combine and Shuffle Base/Example Words
    // ============================================================
    // âš ï¸ MOVED TO wordpack-logic.js as combineAndShuffleWords(pack, difficulty)
    //
    // This function is now available globally from wordpack-logic.js
    //
    // PEDAGOGICAL ARCHITECTURE:
    //   - Base words shuffled and shown FIRST (core vocabulary)
    //   - Example words shuffled and shown SECOND (contextual usage)
    //   - Preserves learning order while adding variety
    //
    // DIFFICULTY LEVELS (optional 2nd parameter):
    //   - 'easy': base words only
    //   - 'medium': example words only
    //   - 'hard': all words (DEFAULT - what DecoderTest uses)
    //
    // DecoderTest calls: combineAndShuffleWords(pack)
    //   â†’ No difficulty param â†’ defaults to 'hard' â†’ returns all words
    //
    // Use cases in ANY language learning game:
    //   - Flashcard decks (progressive difficulty)
    //   - Quiz games (easy/medium/hard modes)
    //   - Memory games (controlled word sets)
    //   - Typing games (adaptive difficulty)
    //   - ANY game with base+example word structure
    //
    // See wordpack-logic.js:420 for full documentation
    // ============================================================


    // ============================================================
    // INITIALIZATION: Load Data on Page Load
    // ============================================================

    /*
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ initialize() - Main initialization function                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ WORKFLOW (with state persistence):                                     â”‚
      â”‚   1. Restore saved state from localStorage (if any)                    â”‚
      â”‚   2. Load data for restored language (or default Spanish)              â”‚
      â”‚   3. Validate restored state against loaded data                       â”‚
      â”‚   4. Setup UI event listeners                                          â”‚
      â”‚   5. Sync UI to reflect restored state                                 â”‚
      â”‚   6. Auto-select first act/pack if needed                              â”‚
      â”‚   7. Display vocabulary                                                â”‚
      â”‚                                                                        â”‚
      â”‚ KEY PRINCIPLE: User returns to EXACTLY where they left off             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    */
    async function initialize() {
      updateDebugInfo('Initializing...');

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STEP 1: Restore saved state from localStorage
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // This sets state.currentLanguage, state.currentAct, state.currentPack,
      // state.currentNativeLanguage, and mode flags if they were saved.
      const hadSavedState = restoreSavedState();

      updateDebugInfo(`Loading ${state.currentLanguage} data...`);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STEP 2: Load data for the restored language (or default)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      await loadLanguageData(state.currentLanguage);

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STEP 3: Validate restored state against loaded data
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // This ensures saved act/pack still exist in the loaded data.
      // If not, they'll be set to null and auto-selected below.
      if (hadSavedState) {
        validateAndFixState();
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STEP 4: Setup UI event listeners
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      setupLanguageRadioButtons();
      setupModeCheckboxes();  // ENCAPSULATED: Radio buttons for view modes
      populateActDropdown();
      populateNativeLanguageDropdown();

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STEP 5: Sync UI to reflect restored state
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // The UI elements need to be updated to match the restored state
      syncUIToState();

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STEP 6: Auto-select or restore act/pack
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      if (state.currentAct && state.currentPack) {
        // We have valid restored state - just update dropdowns and display
        document.getElementById('actSelect').value = state.currentAct;
        populatePackDropdown();
        document.getElementById('packSelect').value = state.currentPack;
        displayVocabulary();
      } else {
        // No valid saved state - auto-select first act and pack (ENCAPSULATED - DRY)
        autoSelectFirstActAndPack();
      }

      updateDebugInfo('Initialization complete. Ready to use.');
    }

    // ============================================================
    // DELETED: syncUIToState()
    // ============================================================
    // This was a DecoderTest-specific wrapper function.
    // If needed, implement the UI syncing logic directly inline during initialization.
    // The pattern: set .checked and .value properties on UI elements to match state.
    // ============================================================


    // ============================================================
    // KEY FEATURE: Language Selection (Radio Buttons)
    // Core Objective: Switch between target languages (Spanish/Chinese/English)
    // Key Behaviors:
    //   - Reloads all act data for selected language
    //   - Resets native language to first available option
    //   - Auto-selects first act/pack via encapsulated function (DRY)
    // ============================================================

    // ============================================================
    // DELETED: setupLanguageRadioButtons()
    // ============================================================
    // This was a DecoderTest-specific wrapper function for setting up language switcher UI.
    // If needed, implement event listeners directly inline during initialization.
    // The pattern: querySelectorAll radio buttons, addEventListener for each.
    // ============================================================

    // ============================================================
    // KEY FEATURE: Mode Checkboxes (DRY ENCAPSULATION)
    // Core Objective: Toggle display modes (multiple choice, typing, pronunciation)
    // Key Behaviors:
    //   - Each checkbox toggles a state flag
    //   - Some modes require state reset (typing, pronunciation)
    //   - All modes refresh vocabulary display on change
    //   - Single configuration-driven function (DRY)
    // ============================================================

    // ============================================================
    // DELETED: setupModeCheckboxes()
    // ============================================================
    // This was a DecoderTest-specific wrapper function for setting up mode switcher UI.
    // If needed, implement event listeners directly inline during initialization.
    // The pattern: querySelectorAll mode radio buttons, addEventListener for each.
    // ============================================================


    // ============================================================
    // UPDATE PRONUNCIATION DISPLAY: Show Score in Table Cell
    // ============================================================

    // ============================================================
    // DELETED: updatePronunciationDisplay()
    // ============================================================
    // This was a DecoderTest-specific wrapper function.
    // If needed, implement the score update logic directly inline after pronunciation.
    // The pattern: find the score cell in the row, update textContent and title.
    // ============================================================



    // ============================================================
    // PRONUNCIATION SIMILARITY & LEVENSHTEIN DISTANCE
    // ============================================================
    // âš ï¸ MOVED TO wordpack-logic.js
    //
    // The following functions are now available globally from wordpack-logic.js:
    //   - levenshteinDistance(str1, str2)
    //   - calculateSimilarity(expected, heard, language)
    //   - normalizePronunciationText(text, language)
    //   - getSimilarityThreshold(word)
    //
    // These functions work for pronunciation scoring in ANY language learning game:
    //   - Speaking practice games
    //   - Pronunciation drills
    //   - Voice-controlled games
    //
    // See wordpack-logic.js for full documentation and usage examples.
    // ============================================================

    // ============================================================
    // CHARACTER NORMALIZATION: For Typing Comparison
    // ============================================================
    // âš ï¸ MOVED TO wordpack-logic.js as normalizeChar()
    // Use normalizeChar() instead of normalizeCharForTyping()
    // This function is available globally after loading wordpack-logic.js
    // ============================================================

    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘                                                                              â•‘
    // â•‘       CHINESE CHARACTER + PINYIN COUPLING SYSTEM                             â•‘
    // â•‘       (Anti-Decoupling Applied to Character Level)                           â•‘
    // â•‘                                                                              â•‘
    // â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    // â•‘                                                                              â•‘
    // â•‘  PURPOSE:                                                                    â•‘
    // â•‘  Ensure each Chinese character is PERMANENTLY LINKED to its pinyin.         â•‘
    // â•‘  This is the SAME anti-decoupling principle as flashcard front/back,        â•‘
    // â•‘  but applied at the character level instead of card level.                  â•‘
    // â•‘                                                                              â•‘
    // â•‘  THE PROBLEM:                                                                â•‘
    // â•‘  Chinese: "å°çŒ«"     Pinyin: "xiÇo mÄo"                                      â•‘
    // â•‘  If stored separately, they can get out of sync:                            â•‘
    // â•‘    - Someone edits Chinese to "å°çŒ«å’ª" but forgets pinyin                   â•‘
    // â•‘    - Pinyin syllables don't match character count                           â•‘
    // â•‘    - User sees wrong pinyin under wrong character                           â•‘
    // â•‘                                                                              â•‘
    // â•‘  THE SOLUTION:                                                               â•‘
    // â•‘  Transform at load time into COUPLED objects:                               â•‘
    // â•‘  [                                                                           â•‘
    // â•‘    { char: "å°", pinyin: "xiÇo" },                                           â•‘
    // â•‘    { char: "çŒ«", pinyin: "mÄo" }                                             â•‘
    // â•‘  ]                                                                           â•‘
    // â•‘  Now they CANNOT get out of sync - they're properties of same object!       â•‘
    // â•‘                                                                              â•‘
    // â•‘  FUNCTIONS IN THIS SECTION:                                                  â•‘
    // â•‘  1. coupleChineseWithPinyin() - Creates the coupled array                   â•‘
    // â•‘  2. renderChineseWithPinyin() - Creates HTML with pinyin under chars        â•‘
    // â•‘  3. setupChineseDisplayOptions() - Handles checkbox events                  â•‘
    // â•‘  4. updateChineseOptionsVisibility() - Shows/hides options panel            â•‘
    // â•‘                                                                              â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // ============================================================
    // CHINESE COUPLING: Character + Pinyin Pairing
    // ============================================================
    // âš ï¸ MOVED TO wordpack-logic.js as coupleChineseWithPinyin()
    //
    // This function is now available globally from wordpack-logic.js
    // Handles Latin blocks (ATMæœº, WhatsAppæ¶ˆæ¯) and punctuation
    // Returns array of {char, pinyin} objects for rendering
    //
    // Use cases in ANY language learning game:
    //   - Flashcards with Chinese text
    //   - Quiz games with Chinese options
    //   - Typing games with Chinese target words
    //   - Memory games with Chinese pairs
    //
    // See wordpack-logic.js for full documentation
    // ============================================================

    // ============================================================
    // DEBUG VERSION: Returns detailed coupling information
    // ============================================================
    // ============================================================
    // DELETED: coupleChineseWithPinyinDebug()
    // ============================================================
    // This was a DecoderTest-specific debug function for troubleshooting Chinese+pinyin coupling.
    // If needed for debugging, use window.coupleChineseWithPinyin() from wordpack-logic.js
    // and console.log the result to inspect the coupling.
    // Reusability 5/10 - debugging tool, not core game logic.
    // ============================================================

    // ============================================================
    // CHINESE RENDERING: Display Characters with Pinyin
    // ============================================================
    // âš ï¸ Core functions MOVED TO wordpack-logic.js
    //
    // wordpack-logic.js provides:
    //   - renderChineseWithPinyin(coupledArray) - always shows both char+pinyin
    //   - renderChineseText(text, pinyin, isChinese) - wrapper for coupling+rendering
    //
    // DecoderTest-specific wrappers below handle state.showChineseChars / state.showPinyin
    // ============================================================

    // ============================================================
    // DELETED: renderChineseWithPinyin()
    // ============================================================
    // USE INSTEAD: window.renderChineseWithPinyin(coupledArray) from wordpack-logic.js
    //
    // Migration:
    //   OLD: const element = renderChineseWithPinyin(coupled)
    //   NEW: const element = window.renderChineseWithPinyin(coupled)
    //
    // The shared function renders Chinese+pinyin coupling as HTML elements.
    // Exact duplicate - reusability 10/10.
    // ============================================================

    // ============================================================
    // DELETED: renderChineseText()
    // ============================================================
    // USE INSTEAD: window.renderChineseText(text, pinyin, isChinese) from wordpack-logic.js
    //
    // Migration:
    //   OLD: const element = renderChineseText(text, pinyin, isChinese)
    //   NEW: const element = window.renderChineseText(text, pinyin, isChinese)
    //
    // The shared function couples + renders Chinese text with pinyin.
    // Exact duplicate - reusability 10/10.
    // ============================================================

    // ============================================================
    // CHINESE OPTIONS: Checkbox Setup and Visibility
    // ============================================================

    // ============================================================
    // DELETED: setupChineseDisplayOptions()
    // ============================================================
    // This was a DecoderTest-specific wrapper function.
    // If needed, implement directly inline or use shared utilities.
    // ============================================================

    // ============================================================
    // DELETED: updateChineseOptionsVisibility()
    // ============================================================
    // This was a DecoderTest-specific wrapper function.
    // If needed, implement directly inline or use shared utilities.
    // ============================================================

    // ============================================================
    // POPULATE ACT DROPDOWN: Based on Loaded Data
    // ============================================================

    // ============================================================
    // DELETED: populateActDropdown()
    // ============================================================
    // USE INSTEAD: window.populateActSelector(selectElement, loadedActMeta, onChange)
    //                from wordpack-logic.js
    //
    // Migration:
    //   OLD: populateActDropdown()
    //   NEW: window.populateActSelector(
    //          document.getElementById('actSelect'),
    //          state.loadedActMeta,
    //          (actNum) => {
    //            state.currentAct = actNum;
    //            state.currentPack = null;
    //            populatePackDropdown();
    //            displayVocabulary();
    //            saveState();
    //          }
    //        )
    //
    // Similar function with better API - reusability 8/10.
    // ============================================================

    // ============================================================
    // POPULATE PACK DROPDOWN: Based on Selected Act
    // ============================================================

    // ============================================================
    // DELETED: populatePackDropdown()
    // ============================================================
    // USE INSTEAD: window.populatePackSelector(selectElement, actData, onChange)
    //                from wordpack-logic.js
    //
    // Migration:
    //   OLD: populatePackDropdown()
    //   NEW: const actData = state.loadedData[state.currentAct];
    //        window.populatePackSelector(
    //          document.getElementById('packSelect'),
    //          actData,
    //          (packKey) => {
    //            state.currentPack = packKey;
    //            displayVocabulary();
    //            if (state.flashcardMode) {
    //              initFlashcardDeck();
    //              updateFlashcardDisplay();
    //            }
    //            saveState();
    //          }
    //        )
    //
    // Similar function with better API - reusability 8/10.
    // ============================================================

    // ============================================================
    // POPULATE NATIVE LANGUAGE DROPDOWN: Based on Current Language
    // ============================================================

    // ============================================================
    // DELETED: populateNativeLanguageDropdown()
    // ============================================================
    // USE INSTEAD: window.populateNativeLanguageSelector(selectElement, loadedActMeta,
    //                currentNativeLanguage, onChange) from wordpack-logic.js
    //
    // Migration:
    //   OLD: populateNativeLanguageDropdown()
    //   NEW: window.populateNativeLanguageSelector(
    //          document.getElementById('nativeLanguageSelect'),
    //          state.loadedActMeta,
    //          state.currentNativeLanguage,
    //          (langIndex) => {
    //            state.currentNativeLanguage = langIndex;
    //            displayVocabulary();
    //            updateChineseOptionsVisibility();
    //            if (state.flashcardMode) {
    //              initFlashcardDeck();
    //              updateFlashcardDisplay();
    //            }
    //            saveState();
    //          }
    //        )
    //
    // Similar function with better API - reusability 8/10.
    // ============================================================

    // ============================================================
    // STRING NORMALIZATION & MULTIPLE CHOICE GENERATION
    // ============================================================
    // âš ï¸ ALL MOVED TO wordpack-logic.js
    //
    // The following functions are now available globally from wordpack-logic.js:
    //   - normalizeString(str)
    //   - generateWrongAnswers(actData, correctAnswer, count=4)
    //   - generateWrongAnswersWithPinyin(actData, correctAnswer, count=4)
    //
    // These functions work for ANY language learning game:
    //   - Quiz games (4-option multiple choice)
    //   - Temple Run (3-lane choice)
    //   - Memory games (matching pairs)
    //   - Typing race games (autocomplete suggestions)
    //
    // See wordpack-logic.js for full documentation and usage examples.
    // ============================================================


    // ============================================================
    // UPDATE TYPING DISPLAY: Show Progress in Input Box
    // ============================================================

    /*
      Updates the typing input box to show current progress.

      DISPLAY FORMAT:
      - Untyped characters: Shown as 'X'
      - Typed characters: Shown as actual letter
      - Spaces: Shown as space (auto-typed)

      EXAMPLE PROGRESSION for "hola amigo":
      Initial:  "XXXX XXXXX"
      After 'h': "hXXX XXXXX"
      After 'o': "hoXX XXXXX"
      After 'l': "holX XXXXX"
      After 'a': "hola XXXXX"
      After 'a': "hola aXXXX"
      ... etc ...
      Final:    "hola amigo"

      PARAMETERS:
      - wordIndex: Index of word (to get state)
      - correctWord: The correct answer
      - inputElement: The input element to update
    */
    // ============================================================
    // DELETED: updateTypingDisplay()
    // ============================================================
    // USE INSTEAD: window.renderTypingDisplayHTML(typingState, correctWord) from wordpack-logic.js
    //              OR window.getTypingDisplay(typingState, correctWord)
    //
    // Migration:
    //   OLD: updateTypingDisplay(wordIndex, correctWord, inputElement)
    //   NEW: const display = window.getTypingDisplay(state.typingStates.get(wordIndex), correctWord)
    //        inputElement.value = display
    //
    // For HTML rendering:
    //   NEW: const html = window.renderTypingDisplayHTML(state.typingStates.get(wordIndex), correctWord)
    //        element.innerHTML = html
    //
    // Similar function with better API - reusability 6/10.
    // ============================================================

    // ============================================================
    // KEY FEATURE: Vocabulary Table Display (Multi-Mode)
    // Core Objective: Render vocabulary with optional practice modes
    // Key Behaviors:
    //   - Dynamic column count based on enabled modes
    //   - Supports: basic, multiple choice, typing, pronunciation
    //   - Modes can be combined (columns stack)
    //   - Headers update dynamically to match active modes
    // ============================================================

    /*
      Displays vocabulary for the selected wordpack.

      TABLE MODES:

      BASIC MODE (all modes off):
      - 2 columns: Target language (column 0) and Native language (selected)

      MULTIPLE CHOICE MODE (multipleChoiceMode = true):
      - 6 columns: Target language, Native language, + 4 wrong answers
      - Wrong answers are randomly selected from ALL packs in current act
      - Duplicate filtering applied (normalized string comparison)

      TYPING MODE (typingMode = true):
      - 5 columns: Target language, Native language, Typing input, Wrong letters, Wrong count
      - Interactive typing practice with instant feedback

      PRONUNCIATION MODE (pronunciationMode = true):
      - 4 columns: Target language, Native language, Record button, Score percentage
      - Speech recognition using Web Speech API
      - Levenshtein distance for fuzzy string matching

      MODES CAN BE COMBINED:
      - Multiple modes can be enabled simultaneously
      - Columns are added in order: base â†’ multiple choice â†’ typing â†’ pronunciation

      PROCESS:
      1. Get selected wordpack from state.loadedData
      2. Check which modes are enabled
      3. Update table headers accordingly
      4. Loop through words array
      5. For each word:
         - Display word[0] in column 1 (target language - correct answer)
         - Display word[nativeLanguageIndex] in column 2 (translation)
         - If multiple choice mode: Generate and display 4 wrong answers
         - If typing mode: Add typing input box and tracking columns
         - If pronunciation mode: Add record button and score columns
    */

    // ============================================================
    // DISPLAY ALL EDGE CASES: Master toggle showing all packs
    // ============================================================
    /*
      When "Show Edge Cases Only" is checked, this function displays ALL words
      containing Latin abbreviations from ALL wordpacks across ALL acts.

      PURPOSE:
      - Demonstrate edge case handling in validate_pinyin.py
      - Show real examples: ATM, DNA, WhatsApp, Tæ¤, la, los, etc.
      - Help users understand Latin block matching logic

      PROCESS:
      1. Iterate through all acts in state.loadedData
      2. Iterate through all packs in each act
      3. Extract all words from each pack
      4. Filter for words containing Latin characters
      5. Display with pack source information (Pack #: Title)
    */
    // ============================================================
    // DELETED: displayAllEdgeCases()
    // ============================================================
    // This was a DecoderTest-specific function for displaying edge cases.
    // If needed, implement custom edge case detection and display logic.
    // Reusability 6/10 - specific to decoder test debugging.
    // ============================================================

    // ============================================================
    // DISPLAY VOCABULARY: Show current pack or all edge cases
    // ============================================================
    /*
      Main display function for vocabulary table.

      MODES:
      - Normal mode: Display current selected pack
      - Edge case mode: Display all edge cases from all packs (calls displayAllEdgeCases())

      FEATURES:
      - Multiple choice mode: Generate 4 wrong answers from act-wide pool
      - Typing mode: Add typing input, wrong letter tracking, wrong count
      - Pronunciation mode: Record button for speech recognition
      - Chinese rendering: Character + pinyin coupling with visibility toggles

      KEY FUNCTIONS CALLED:
      - combineAndShuffleWords(): Merges base/example words with shuffling
      - generateWrongAnswers(): Creates wrong answers for multiple choice
      - renderChineseText(): Handles Chinese character + pinyin display
      - Levenshtein distance for fuzzy string matching

      MODES CAN BE COMBINED:
      - Multiple modes can be enabled simultaneously
      - Columns are added in order: base â†’ multiple choice â†’ typing â†’ pronunciation

      PROCESS:
      1. Get selected wordpack from state.loadedData
      2. Check which modes are enabled
      3. Update table headers accordingly
      4. Loop through words array
      5. For each word:
         - Display word[0] in column 1 (target language - correct answer)
         - Display word[nativeLanguageIndex] in column 2 (translation)
         - If multiple choice mode: Generate and display 4 wrong answers
         - If typing mode: Add typing input box and tracking columns
         - If pronunciation mode: Add record button and score columns
    */
    // ============================================================
    // DELETED: displayVocabulary()
    // ============================================================
    // This was a DecoderTest-specific function for displaying vocabulary table.
    // If needed, implement custom table rendering logic inline.
    // Reusability 6/10 - specific to decoder test UI.
    // ============================================================
    // ============================================================
    // DELETED: updateDebugInfo()
    // ============================================================
    // This was a DecoderTest-specific function for debug message logging.
    // If needed, use console.log() directly or implement inline.
    // Reusability 6/10 - basic logging utility.
    // ============================================================
    // ============================================================
    // DELETED: handleFlashcardModeChange()
    // ============================================================
    // This was a DecoderTest-specific wrapper function.
    // If needed, use window.initFlashcardDeck() from wordpack-logic.js
    // and implement show/hide logic inline.
    // Reusability 7/10 - flashcard setup logic.
    // ============================================================
    // ============================================================
    // DELETED: updateFlashcardDisplay()
    // ============================================================
    // This was a DecoderTest-specific function for displaying flashcards.
    // If needed, use window.flipCard() and window.renderTargetWordHTML()
    // from wordpack-logic.js to implement flashcard display.
    // Reusability 6/10 - flashcard rendering logic.
    // ============================================================
    /*
      Automatically initialize when DOM is ready.
      This removes the need for a "Run Test" button.
    */
    window.addEventListener('DOMContentLoaded', initialize);

  </script>

  </div> <!-- End content-container -->

</body>
</html>
