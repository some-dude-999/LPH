Function Name,What It Does (Detailed),How It Works (Detailed Implementation),Reusability Score (1-10)
switchLanguage,"Switches the active target language between Spanish Chinese and English across all language learning games. Updates localStorage preference and reloads the page to reinitialize with new language modules. This enables a single game to support multiple target languages without code duplication.","Validates the requested language exists in MODULE_SETS object. Saves the language preference to localStorage under 'selected_language' key. Updates window.currentLanguage and window.MODULE_URLS to point to the new language's module paths. Logs the switch to console and calls window.location.reload() to reinitialize the entire game with new data.",10
getTargetLanguage,"Determines which language the user is currently learning (the target language) by inspecting the loaded module metadata. Returns the language code string (e.g. 'spanish' 'chinese' 'english'). This is critical for determining which column in word arrays contains the target vocabulary.","Iterates through window.loadedActMeta object checking each act's metadata. Extracts wordColumns[0] from __actMeta (column 0 is always the target language by convention). Returns the lowercase language name or null if no metadata found.",10
toTitleCase,"Converts a string to title case format where the first letter is capitalized and remaining letters are lowercase. Used for displaying language names and act names in UI elements.","Checks if string is empty/null and returns empty string if so. Takes first character with charAt(0) and converts to uppercase. Takes remaining characters with slice(1) and converts to lowercase. Concatenates and returns the result.",8
validateTargetLanguageConsistency,"Validates that all loaded act modules have the same target language (wordColumns[0] value). This prevents bugs where different acts accidentally use different target languages which would break the game logic.","Creates a Set to track unique target languages. Iterates through all loaded acts in window.loadedActMeta. Extracts wordColumns[0] from each act's metadata and adds to Set. If Set size > 1 multiple languages were found - logs error with list of conflicting languages and returns false. Returns true if consistent.",9
isChineseMode,"Checks if the current target language is Chinese. Chinese requires special handling throughout the codebase (pinyin rendering character-by-character coupling special typing validation TTS voice selection). This function is called frequently to branch logic appropriately.","Calls getTargetLanguage() to get current target language string. Compares result === 'chinese' (case-sensitive). Returns boolean true if Chinese false otherwise.",10
updateChineseModeClass,"Applies or removes the 'chinese-mode' CSS class on document.body based on whether Chinese is the target language. This CSS class triggers special styling rules for Chinese text rendering (larger font sizes pinyin positioning flex layouts for character grouping).","Calls isChineseMode() to check target language. If true adds 'chinese-mode' class to document.body.classList. If false removes 'chinese-mode' class from document.body.classList. CSS rules defined elsewhere use this class as a selector.",9
getTranslationsConfig,"Retrieves the translations configuration object from loaded module metadata. This object maps available 'I speak' languages to their column indices and display names. For example: {english: {index: 1 display: 'English'} chinese: {index: 2 display: 'ä¸­æ–‡'}}.","Checks if window.loadedActMeta exists. Iterates through all loaded acts looking for first act that has a 'translations' property in its __actMeta. Returns that translations object or null if not found. All acts should have identical translations config so first match is sufficient.",10
getDefaultTranslation,"Returns the default 'I speak' language code for the current target language. This is used when no saved preference exists or when validating saved state. Usually returns 'english' as the default translation language.","Checks if window.loadedActMeta exists and returns 'english' if not. Iterates through loaded acts looking for __actMeta.defaultTranslation property. Returns that value or falls back to 'english' if not found.",9
getWordColumns,"Returns the array of column names from module metadata showing the structure of word arrays. For example Spanish returns ['spanish' 'english' 'chinese' 'pinyin' 'portuguese']. This is critical for understanding which array index corresponds to which language.","Checks if window.loadedActMeta exists. Iterates through loaded acts looking for first act with __actMeta.wordColumns property. Returns that array or null if not found. All acts should have identical column structure so first match is sufficient.",10
getValidLanguages,"Returns an array of valid 'I speak' language codes that the user can select for translations. These are extracted from the translations config object keys. Used for validating saved state and populating language selector dropdowns.","Calls getTranslationsConfig() to get translations object. If translations exist returns Object.keys(translations) as an array. If translations is null returns empty array [].",9
getTtsLanguageCode,"Maps the target language name to a full TTS language code (locale) for text-to-speech voice selection. For example 'spanish' maps to 'es-ES' 'chinese' maps to 'zh-CN'. This improves voice quality by selecting region-specific voices.","Checks if window.loadedActMeta exists. Extracts wordColumns[0] (target language) and converts to lowercase. Looks up language in hardcoded langMap object that maps language names to locale codes. Returns the locale code or null if language not found in map.",10
decodeObfuscatedModule,"Decodes wordpack modules that use 3-layer obfuscation (base64 encoding + zlib compression + string reversal). This is the core function for loading vocabulary data from compressed .js files. Returns the decoded JavaScript object containing all wordpacks for an act.","Imports the module file as ES6 module using dynamic import(). Extracts the 'w' export which contains the compressed base64 string. Decodes base64 to binary using atob() and Uint8Array.from(). Decompresses binary using pako.inflate() (zlib decompression). Converts decompressed binary to string using TextDecoder. Reverses the string using split('').reverse().join('') to undo the reversal obfuscation. Parses the JSON string to get final object. Returns the decoded data object containing pack data and __actMeta.",10
loadAct,"Loads a specific act number (1-indexed) from the MODULE_URLS array. Decodes the obfuscated module extracts __actMeta and separates pack data. Returns an object with {actMeta packs} structure ready for use in the game.","Validates actNumber is within valid range (1 to MODULE_URLS.length). Calculates zero-indexed array position (actNumber - 1). Gets module URL from window.MODULE_URLS[index]. Calls decodeObfuscatedModule(url) to decode the file. Extracts __actMeta from decoded data and stores separately. Deletes __actMeta from decoded data so only pack data remains. Returns object with {actMeta: metadata packs: packData}.",10
shuffleArray,"Shuffles an array using the Fisher-Yates algorithm which guarantees uniform random distribution. Does NOT modify the original array - returns a new shuffled copy. Used everywhere from deck shuffling to wrong answer randomization.","Creates a shallow copy of input array using spread operator [...array]. Iterates backward from last index to 1 using for loop. For each position i generates random index j between 0 and i using Math.floor(Math.random() * (i + 1)). Swaps elements at positions i and j using array destructuring [shuffled[i] shuffled[j]] = [shuffled[j] shuffled[i]]. Returns the shuffled copy.",10
combineAndShuffleWords,"Combines baseWords and exampleWords from a wordpack with controlled shuffling based on difficulty level. Implements pedagogical principle: learners encounter CORE VOCABULARY (base words) before CONTEXTUAL EXAMPLES (example words). Both sections are internally shuffled for variety but base words always appear first overall.","Extracts baseWords and exampleWords arrays from pack object. Shuffles baseWords internally using shuffleArray() and tags each with type: 'Base Word'. Shuffles exampleWords internally and tags with type: 'Example Word'. Checks difficulty parameter: 'easy' returns only shuffled base words 'medium' returns only shuffled example words 'hard' (default) returns concatenation [shuffledBase ...shuffledExamples] preserving pedagogical order. Logs selection statistics and returns combined array.",10
normalizeChar,"Normalizes a single character for accent-insensitive typing comparison. Removes diacritical marks (accents) and converts to lowercase. This defines what counts as 'correct' typing across ALL language learning games. Critical for Spanish (Ã¡ Ã± Ã¼) French (Ã© Ã¨ Ãª) Portuguese (Ã£ Ãµ) etc.","Returns empty string if char is null/undefined. Converts character to lowercase using .toLowerCase(). Applies Unicode NFD normalization which decomposes accented characters into base + combining diacritic. Uses regex /[\u0300-\u036f]/g to remove all combining diacritical marks (Unicode range for accent marks). Returns normalized character. Example: 'Ã¡' â†’ NFD â†’ 'a' + combining acute â†’ remove combining â†’ 'a'.",10
findNextTypingPosition,"Finds the next valid typing position in a word skipping spaces automatically. Implements critical space handling: spaces are NOT typed by user they are auto-marked as typed and skipped. This prevents user from seeing space as next character to type.","Iterates through character array chars from index 0 looking for first position not in typedPositions Set. If all positions filled returns -1 (word complete). Once unfilled position found enters while loop: if character at position is space adds that position to typedPositions Set and increments position. Continues skipping spaces until non-space character found or end of array reached. Returns final position or -1 if reached end.",10
checkTypingKey,"Validates a user's keypress against the expected character at current typing position. Handles space key presses as special case (ignored). Performs accent-insensitive and case-insensitive matching using normalizeChar().","Checks if key is space ' ' and immediately returns 'space' (special case - not right or wrong just ignored). Normalizes user's key press using normalizeChar(key). Normalizes expected target character using normalizeChar(targetChar). Compares normalized strings: if equal returns 'correct' if different returns 'wrong'.",10
isWordComplete,"Checks if a word is complete by verifying all non-space characters have been typed. Spaces don't count toward completion since they're auto-filled. Used to determine when to trigger success animations and move to next word.","Filters chars array to count only non-space characters using .filter(c => c !== ' ').length. Compares typedPositions.size to total non-space character count. Returns true if size >= totalNonSpaceChars meaning all typeable characters are typed. Returns false otherwise.",10
coupleChineseWithPinyin,"Creates an anti-decoupled data structure pairing each Chinese character with its pinyin syllable. This prevents characters and pinyin from getting out of sync. Handles edge case: Latin letters (ATM DNA WhatsApp) where each letter maps to itself letter-by-letter.","Splits pinyin string into array of syllables using /\s+/ regex (whitespace separator). Initializes pinyinIndex counter at 0. Iterates through each character in chinese string. For each character checks if it matches /[a-zA-Z]/ (Latin letter). If Latin: pushes {char: letter pinyin: letter} (letter maps to itself). If Chinese: pushes {char: character pinyin: pinyinParts[pinyinIndex]} and increments pinyinIndex. Returns array of {char pinyin} objects maintaining 1:1 coupling.",10
renderChineseWithPinyin,"Renders a coupled Chinese character array as HTML elements with characters on top and pinyin below each character. Uses CSS flexbox for horizontal layout with vertical character groups. This is the visual representation of Chinese text throughout all games.","Creates container span with class 'chinese-coupled'. Iterates through coupledArray (from coupleChineseWithPinyin). For each {char pinyin} pair: creates span with class 'char-group' creates span with class 'chinese-char' containing char creates span with class 'pinyin' containing pinyin appends both to char-group appends char-group to container. Returns container element ready for DOM insertion.",10
renderChineseText,"Convenience wrapper that couples and renders Chinese text in a single function call. Takes raw Chinese and pinyin strings returns ready-to-append HTML element. Simplifies calling code by combining coupleChineseWithPinyin + renderChineseWithPinyin.","Calls coupleChineseWithPinyin(chinese pinyin) to create coupled array. Passes result to renderChineseWithPinyin(coupled) to create HTML element. Returns the final HTML element.",10
getChineseHtml,"Returns HTML string representation of Chinese text with pinyin (useful for innerHTML assignments). Same as renderChineseText but returns string instead of DOM element.","Calls renderChineseText(chinese pinyin) to create DOM element. Extracts outerHTML property from element to get string representation. Returns HTML string.",10
saveState,"Saves game state to localStorage enabling persistence across browser sessions. Serializes state object to JSON string and stores under STORAGE_KEY. Catches and logs errors if localStorage unavailable (private browsing quota exceeded).","Wraps localStorage.setItem in try-catch block. Calls JSON.stringify(stateObj) to convert object to string. Calls localStorage.setItem(STORAGE_KEY jsonString) to persist. If error occurs logs warning with console.warn but doesn't throw (graceful degradation).",10
loadState,"Loads game state from localStorage restoring user's previous settings. Deserializes JSON string back to JavaScript object. Returns null if no saved state exists or parsing fails.","Wraps localStorage.getItem in try-catch block. Calls localStorage.getItem(STORAGE_KEY) to retrieve JSON string. If string exists parses with JSON.parse(stored) to reconstruct object and returns it. If no stored data or parsing fails returns null. Error handling with console.warn for graceful degradation.",10
toggleDebugMode,"Toggles debug mode on/off enabling developer tools for testing. Debug mode shows vocabulary table with word types simulate buttons language selector. State is ephemeral (not persisted) always starts OFF on page load. Toggled with Ctrl+` hotkey.","Inverts window.DEBUG_MODE boolean flag using ! operator. Queries DOM for #debug-vocab-table element. If found checks new DEBUG_MODE value: if true sets display='block' and calls updateDebugTable() to populate table if false sets display='none'. Logs new state to console. Returns new DEBUG_MODE value.",9
updateDebugTable,"Populates the debug vocabulary table with current deck data showing what words are loaded and their types. Supports backwards compatibility by accepting options object or reading from global scope. Renders target language native language and word type columns.","Checks if DEBUG_MODE is false and exits early if so. Determines data source: if options object empty tries to get deck currentDeck targetLang from getTargetLanguage() nativeLang from window.nativeLanguage etc. Otherwise uses provided options. Gets references to #debug-vocab-tbody and #debug-table-header-row. Updates header with language names. Clears existing tbody rows. If no deck displays 'No deck loaded' message. Otherwise iterates through deck array: extracts target word translation and type from each card creates table row with 3 cells handles Chinese rendering with coupleChineseWithPinyin if needed appends row to tbody.",8
initializeDebugUI,"Creates and injects debug UI HTML elements into the DOM. Builds fixed-position vocabulary table with CSS styling simulate buttons and language selector. Only runs once - checks if UI already exists before creating.","Checks if #debug-vocab-table already exists in DOM and returns early if so. Creates div#debug-vocab-table with inline CSS (fixed position bottom-left high z-index translucent background). Creates nested HTML structure: table with thead/tbody for vocabulary display div with simulate buttons (Right Wrong Near Victory) div with language radio buttons (Spanish Chinese English). Sets initial display='none' (debug starts hidden). Appends container to document.body. Sets up event listeners: radio button change events call switchLanguage() and reload page simulate button clicks call respective window.simulate* functions.",7
normalizePronunciationText,"Normalizes text for pronunciation similarity scoring by removing punctuation whitespace and converting to lowercase. Used before Levenshtein distance calculation to focus on phonetic content rather than formatting.","Converts text to lowercase using .toLowerCase(). Uses regex .replace(/[^\w\s]/g '') to remove all non-word non-space characters (punctuation). Uses .replace(/\s+/g ' ') to collapse multiple spaces into single space. Calls .trim() to remove leading/trailing whitespace. Returns normalized string.",9
getSimilarityThreshold,"Determines the required similarity percentage for pronunciation to be considered correct. Longer words get lower thresholds (more forgiving) shorter words require higher accuracy. Returns value between 0.0 and 1.0.","Gets word length from word.length. Implements threshold logic: if length <= 4 return 0.85 (85% accuracy required for short words) if length <= 8 return 0.80 (80% for medium words) if length > 8 return 0.75 (75% for long words). This scaling accounts for fact that longer words have more opportunity for small errors.",9
levenshteinDistance,"Calculates edit distance between two strings using dynamic programming. Returns minimum number of single-character edits (insertions deletions substitutions) needed to transform str1 into str2. This is core algorithm for fuzzy string matching in pronunciation scoring.","Creates 2D matrix (str1.length+1) x (str2.length+1) for dynamic programming. Initializes first row as [0 1 2 3...] representing cost of inserting each character of str2. Initializes first column as [0 1 2 3...] representing cost of deleting each character of str1. Double nested loop fills matrix: for each position [i][j] calculates three costs: matrix[i-1][j]+1 (deletion) matrix[i][j-1]+1 (insertion) matrix[i-1][j-1]+substitutionCost (substitution where cost=0 if chars match cost=1 if different). Takes minimum of three costs and stores in matrix[i][j]. Returns bottom-right value matrix[str1.length][str2.length] as final edit distance.",10
calculateSimilarity,"Calculates pronunciation similarity score as percentage (0-100) using Levenshtein distance. Normalizes both expected and heard text then applies edit distance algorithm. Returns 0 if heard text empty or 100 if exact match otherwise scales distance to percentage.","Normalizes both expected and heard strings using normalizePronunciationText(). Returns 0 if heard is empty string. Returns 100 if normalized strings are identical. Calculates Levenshtein distance using levenshteinDistance(normalizedExpected normalizedHeard). Uses formula: similarity = ((maxLength - distance) / maxLength) * 100 where maxLength is max(expected.length heard.length). Clamps result between 0 and 100 using Math.max(0 Math.min(100 similarity)). Returns rounded percentage.",10
getFeedbackMessage,"Returns user-friendly feedback message based on pronunciation similarity score. Messages range from 'Perfect!' for high scores to 'Keep trying!' for low scores. Provides encouragement and guidance.","Checks score against thresholds using if-else chain: if score >= 95 return 'Perfect!' if score >= 85 return 'Great!' if score >= 75 return 'Good job!' if score >= 65 return 'Not bad!' if score >= 50 return 'Almost there...' otherwise return 'Keep trying!'.",8
getScoreClass,"Returns CSS class name for color-coding pronunciation scores. Green for high scores yellow for medium red for low. Used to apply visual feedback styling.","Checks score against thresholds: if score >= 80 return 'score-high' if score >= 60 return 'score-medium' otherwise return 'score-low'. These class names correspond to CSS rules for green yellow red colors respectively.",8
updatePronunciationDebug,"Updates debug display showing pronunciation details: expected vs heard text similarity score and feedback message. Used during development to troubleshoot speech recognition accuracy.","Queries DOM for #pronunciation-debug element. Returns early if not found. Updates innerHTML with formatted debug information: expected word heard transcription similarity percentage score class (color) and feedback message. Uses template literals for clean formatting.",7
hideFeedback,"Hides pronunciation feedback elements (score message heard text close button). Resets visibility and content back to initial hidden state. Called when navigating to new card or closing feedback.","Iterates through feedbackElements array. For each element sets style.display='none' to hide. If element has data-original-display attribute restores that value. Queries for child elements with classes score-value feedback-message heard-value. If found resets textContent to empty string.",8
normalizeString,"Normalizes string for duplicate detection in multiple choice generation. Converts to lowercase removes spaces and punctuation. Two strings that normalize to same value are considered duplicates (e.g. 'hello!' and 'Hello' both normalize to 'hello').","Converts string to lowercase using .toLowerCase(). Uses .replace(/[^a-z0-9]/g '') regex to remove all non-alphanumeric characters (spaces punctuation accents etc.). Returns normalized string.",9
generateWrongAnswers,"Generates specified number of wrong answers for multiple choice questions by randomly sampling from all wordpacks in current act. Implements duplicate detection using normalized strings to avoid showing essentially identical answers. Filters out the correct answer.","Extracts normalizedCorrect by calling normalizeString(correctAnswer). Initializes empty wrongAnswers array and used Set for tracking normalized strings. Adds normalizedCorrect to used Set to prevent it appearing as wrong answer. Creates candidatePool by iterating through all packs in actData: extracts words array from each pack flattens into single array filters to only target language (column 0). Shuffles candidate pool using shuffleArray(). Iterates through shuffled pool: normalizes each candidate filters if already in used Set or if normalized matches correct answer. If passes adds to wrongAnswers and used Set. Continues until wrongAnswers.length reaches count parameter or pool exhausted. Returns wrongAnswers array.",10
generateWrongAnswersWithPinyin,"Generates wrong answers with Chinese+Pinyin rendering for multiple choice questions. Same logic as generateWrongAnswers but returns rendered HTML elements instead of plain strings. Used when native language is Chinese.","Nearly identical to generateWrongAnswers. Additional step: for each selected wrong answer extracts Chinese text (column 0) and pinyin (column 1) calls renderChineseText(chinese pinyin) to create HTML element pushes element instead of string to wrongAnswers array. Returns array of HTML elements instead of strings.",9
showStamp,"Generic stamp animation function that shows a stamp element plays a sound waits for duration then hides and calls completion callback. Used by both success and failure stamp animations. Implements DRY principle by encapsulating common animation pattern.","Sets stampElement.classList.add('visible') to trigger CSS animation. Calls soundFunction() to play success/failure sound. Calls setTimeout() with specified duration (default 1500ms): callback removes 'visible' class to hide stamp if onComplete callback provided calls it. This pattern ensures stamp+sound+delay always happen together consistently.",10
showSuccessStamp,"Shows green checkmark success stamp with ding sound. Wrapper around showStamp() with success-specific parameters. Used when user gives correct answer removes card from deck completes typing successfully scores high on pronunciation etc.","Calls showStamp(stampElement playDingSound onComplete) passing success stamp element ding sound function and completion callback. Uses default 1500ms duration.",10
showFailureStamp,"Shows red X failure stamp with buzz sound. Wrapper around showStamp() with failure-specific parameters. Used when user gives wrong answer adds duplicate cards to deck makes typing error scores low on pronunciation etc.","Calls showStamp(stampElement playBuzzSound onComplete) passing failure stamp element buzz sound function and completion callback. Uses default 1500ms duration.",10
loadVoicesForLanguage,"Loads and filters available TTS voices for specified language code. Returns array of voice objects that match language optionally filtered by voiceURI. Used to populate voice selector dropdown and restore saved voice preference.","Checks if window.speechSynthesis exists returns empty array if not (TTS not supported). Calls speechSynthesis.getVoices() to retrieve all available system voices. Filters voices array: includes voice if voice.lang matches languageCode (case insensitive startsWith comparison). If voiceURI provided prioritizes that voice by placing it first in array: finds matching voice removes from array unshifts to front. Returns filtered voices array.",9
speakWord,"Speaks a word using Web Speech API text-to-speech. Accepts text to speak and options object for voice speed volume. Creates SpeechSynthesisUtterance configures it and queues for speaking. Used for pronunciation practice pronunciation button auto-pronounce in listening mode.","Checks if window.speechSynthesis exists returns early if not. Creates new SpeechSynthesisUtterance(text) object. Extracts options: voice (default null) speed (default 1.0) volume (default 1.0). If voice provided sets utterance.voice. Sets utterance.rate to speed value. Sets utterance.volume to volume value. Calls speechSynthesis.speak(utterance) to queue speaking.",10
findVoiceByURI,"Finds a specific TTS voice by its voiceURI property from array of voices. Returns the matching voice object or null if not found. Used when restoring saved voice preference from localStorage.","Iterates through voices array using .find(). For each voice checks if voice.voiceURI === voiceURI (exact string match). Returns first matching voice or undefined (converted to null with || null).",8
initializeTypingState,"Creates initial typing state object for a word. Tracks which characters typed which characters wrong and total wrong count. Returns object with chars array typed Set wrongLetters array wrongCount counter.","Splits targetWord into character array using .split(''). Creates new Set() for tracking typed positions (empty initially). Creates empty array [] for wrongLetters. Initializes wrongCount to 0. Returns object {chars typed wrongLetters wrongCount}.",9
getTypingDisplay,"Generates display string showing typing progress with X for untyped characters and actual letters for typed characters. Spaces are shown as spaces. Used to render typing input box showing user's current progress.","Iterates through chars array with .map(): if typedPositions.has(i) returns actual character chars[i] otherwise returns 'X' placeholder. Joins array into string with .join(''). Returns display string.",9
removeCard,"Removes the card at currentIndex from deck array. Returns object with {deck newIndex wasLastCard} structure. Handles edge case: if removing last card adjusts index to show previous card. Used when user marks card as 'got it' or completes challenge correctly.","Creates deckCopy using spread operator [...deck]. Calls deckCopy.splice(currentIndex 1) to remove card at index. Calculates wasLastCard = (currentIndex === deck.length - 1). If wasLastCard sets newIndex = Math.max(0 currentIndex - 1) otherwise newIndex = currentIndex. Returns {deck: deckCopy newIndex wasLastCard}.",10
addDuplicateCards,"Adds multiple copies of a card to the deck immediately after original card position. Used when user marks card as 'confused' or makes errors to increase practice repetition. Returns new deck with duplicates inserted.","Creates deckCopy using spread operator [...deck]. Calls deckCopy.splice(currentIndex + 1 0 ...Array(count).fill(card)): inserts count copies of card starting at position currentIndex + 1 using spread operator with Array(count).fill(card). Returns {deck: deckCopy}.",10
createDeckFromPack,"Creates a complete game deck from a wordpack by extracting and transforming word data. Handles target/translation column selection Chinese pinyin typing targets anti-decoupled card structure difficulty filtering. Returns array of card objects ready for game loop.","Extracts options: targetColumnIndex (default 0) translationColumnIndex (required) difficulty (default 'hard') additionalProperties (optional). Calls combineAndShuffleWords(pack difficulty) to get shuffled words with pedagogical ordering. Maps each wordObj: creates unique card.id using pack number and word index stores rawWord array extracts target and translation by column index determines if target is Chinese (isChinese) determines typing target (pinyin if Chinese target word otherwise) creates card object {id spanish/chinese/english translation isChinese typingTarget type rawWord}. Applies additionalProperties if provided using spread operator. Returns cards array.",10
populateActSelector,"Populates an act selector dropdown with act options from loaded metadata. Clears existing options creates option element for each act sets onChange handler. Used in menu/setup screens for act selection.","Clears selectElement.innerHTML. Extracts act numbers from loadedActMeta using Object.keys() converts to numbers sorts ascending. Iterates through sorted acts: creates option element sets value to actNumber sets textContent to 'Act N - ActName' from metadata.actName appends to select. Sets onchange handler: extracts selected actNum from e.target.value calls onChange callback with number. Returns void.",8
populatePackSelector,"Populates wordpack selector dropdown with pack options from current act data. Extracts pack titles from metadata displays formatted options. Sets onChange handler for pack selection.","Clears selectElement.innerHTML. Iterates through actData object keys (pack keys). For each pack: extracts pack.meta.wordpack (pack number) extracts pack.meta.english (pack title) creates option element sets value to packKey sets textContent to 'Pack N - Title' appends to select. Sets onchange handler: calls onChange callback with selected packKey. Returns void.",8
populateNativeLanguageSelector,"Populates 'I speak' language selector dropdown with available translation languages from metadata. Shows display names (e.g. 'English' 'ä¸­æ–‡' 'PortuguÃªs'). Sets currentValue as selected option.","Clears selectElement.innerHTML. Iterates through translations object using Object.entries(). For each [code config]: creates option element sets value to config.index (column index) sets textContent to config.display (localized name) checks if config.index === currentValue and sets selected=true appends to select. Sets onchange handler: converts e.target.value to number calls onChange with language index. Returns void.",9
navigateToPrevious,"Handles navigation to previous card in deck. Decrements index with wraparound to last card. Calls update callback and saves state. Returns new index.","Calculates newIndex = (currentIndex - 1 + deck.length) % deck.length using modulo for wraparound. If callbacks.update provided calls callbacks.update(). If callbacks.save provided calls callbacks.save(). Returns newIndex.",9
navigateToNext,"Handles navigation to next card in deck. Increments index with wraparound to first card. Calls update callback and saves state. Returns new index.","Calculates newIndex = (currentIndex + 1) % deck.length using modulo for wraparound. If callbacks.update provided calls callbacks.update(). If callbacks.save provided calls callbacks.save(). Returns newIndex.",9
resetDeckToOriginal,"Resets current deck back to original shuffled state removing all modifications (removed cards added duplicates progress). Resets index to 0. Calls callbacks for update and save. Returns original deck.","Creates deckCopy using spread operator [...originalDeck]. Sets index to 0. If callbacks.reset provided calls callbacks.reset(deckCopy 0). If callbacks.update provided calls callbacks.update(). If callbacks.save provided calls callbacks.save(). Returns deckCopy.",9
navigateToNextPack,"Finds the next pack key in sequential order from current pack. Wraps around to first pack if at end. Used for 'next pack' button functionality. Returns next pack key.","Extracts all pack keys from wordpacks object using Object.keys(). Finds current pack index using .findIndex(key => key === currentPackKey). Calculates next index = (currentIndex + 1) % packKeys.length with wraparound. Returns packKeys[nextIndex].",9
setTTSSpeed,"Updates TTS speed setting and updates UI button states. Sets aria-pressed and active class on selected button removes from others. Saves state. Returns void.","Iterates through speedButtons array. For each button: checks if parseFloat(btn.dataset.speed) === speed if match sets aria-pressed='true' and adds 'active' class if no match sets aria-pressed='false' and removes 'active' class. This provides visual and accessibility feedback for selected speed.",8
renderTypingDisplayHTML,"Renders typing progress as HTML with color-coded characters. Green for correct red for wrong gray for untyped. Returns HTML string for innerHTML assignment.","Maps over chars array creating span for each character. For each character at index i: if index in wrongPositions creates red span with 'wrong' class if index in typedPositions creates green span with 'correct' class otherwise creates gray span with 'untyped' class showing 'X'. Joins spans into string and returns.",8
renderTargetWordHTML,"Renders target word as HTML handling Chinese text with pinyin coupling. Returns HTML string ready for innerHTML. Checks isChineseTarget flag to determine rendering method.","If isChineseTarget: extracts chinese and pinyin from card.rawWord array calls getChineseHtml(chinese pinyin) to create coupled HTML returns HTML string. Otherwise: creates plain text span returns card property (spanish/english/chinese) as text content.",9
renderTranslationHTML,"Renders translation text as HTML handling Chinese translations with pinyin. Checks if translation language is Chinese and renders accordingly.","Extracts native language from card object properties. Checks if nativeLanguage key is 'chinese': if yes extracts chinese and pinyin from card.rawWord calls getChineseHtml() returns coupled HTML. If no returns plain text from card.translation property.",9
createButtonTooltip,"Creates and appends tooltip to button with HTML content. Tooltip appears on hover above/below button. Returns the tooltip element reference.","Queries for existing #tooltip-BUTTONID removes if found. Creates div with id='tooltip-{button.id}' class='tooltip'. Sets innerHTML to htmlContent. Appends tooltip div to button element. Returns tooltip reference.",7
updateWordpackTitleDisplay,"Updates wordpack title display element with formatted pack number and title. Extracts metadata from wordpacks object.","Gets pack data from wordpacks[packKey]. Extracts packNumber from pack.meta.wordpack. Extracts title from pack.meta.english. Sets titleElement.textContent to 'Pack N - Title' format.",7
simulateCorrectAnswer,"Simulates a correct answer for testing. Shows success stamp removes card from deck updates to new position calls success callback. Used in debug mode for rapid testing.","Checks if deck is empty returns early if so. Calls showSuccessStamp() with callback: inside callback removes current card using removeCard(deck currentIndex) gets {deck: newDeck newIndex} updates state calls onSuccess() callback if provided. Returns {deck newIndex}.",7
simulateWrongAnswer,"Simulates a wrong answer for testing. Shows failure stamp adds duplicate cards to deck calls failure callback. Used in debug mode for rapid testing.","Checks if deck is empty returns early if so. Calls showFailureStamp() with callback: inside callback adds duplicates using addDuplicateCards(deck currentIndex duplicateCount) gets {deck: newDeck} updates state calls onFailure() callback if provided. Returns {deck: newDeck}.",7
simulateNearVictory,"Simulates near-victory state for testing endgame behavior. Reduces deck to last 3 cards resets index to 0. Used in debug mode to test victory conditions without playing full game.","Takes first 3 cards from deck using deck.slice(0 3). Sets index to 0. Calls onSimulate callback if provided passing new deck and index. Returns {deck: reducedDeck index: 0}.",7
getAudioContext,"Gets or creates Web Audio API context singleton. Prevents multiple context creation which causes audio glitches and memory leaks. Returns global audioContext instance.","Checks if global audioContext variable is null/undefined. If null creates new AudioContext using window.AudioContext || window.webkitAudioContext (webkit prefix for Safari). Returns audioContext reference.",10
playTypingSound,"Plays typing sound (mechanical keyboard click) using shared sound function. This function exists in wordpack-logic.js for module coordination but actual implementation is in game-sounds.js as playScribbleSound().","Checks if window.playScribbleSound function exists. If exists calls window.playScribbleSound(). If not exists logs warning that game-sounds.js not loaded. This provides fallback behavior and helps debug missing dependencies.",10
handleTypingInput,"Handles typing input validation for a single keypress. Finds next position checks if key is correct updates typed positions tracks wrong attempts returns status and updated state.","Gets reference to typingState from global state by wordIndex. Extracts chars typed wrongLetters wrongCount from typingState. Calls findNextTypingPosition(chars typed) to get next position skipping auto-typed spaces. If nextPos is -1 word is already complete returns {status: 'complete'}. Gets targetChar = chars[nextPos]. Calls checkTypingKey(key targetChar) to validate. If result is 'space' plays sound returns {status: 'space'}. If result is 'correct': plays success sound adds position to typed Set updates input display checks if word now complete returns appropriate status. If result is 'wrong': plays failure sound tracks wrong letter increments wrongCount updates display returns {status: 'wrong'}.",10
resetListeningState,"Resets speech recognition listening state and button UI when recognition stops completes or errors. Restores button to initial ready state.","Sets global isListening = false. Sets global currentListeningWordIndex = null. If recognition object exists calls recognition.abort() to force stop. Sets recordButton textContent to 'ðŸŽ¤ Record'. Sets recordButton disabled = false. Removes 'listening' class from button classList.",9
startListeningForPronunciation,"Starts speech recognition for pronunciation practice. Configures recognition language starts listening processes results calculates similarity score shows feedback.","Checks if SpeechRecognition API available returns early if not. Checks if already listening returns early if so. Sets global currentListeningWordIndex = wordIndex. Sets global isListening = true. Updates button UI: text to 'ðŸŽ¤ Listening...' adds 'listening' class disables button. Calls resetListeningState() to ensure clean state. Gets language code from getTtsLanguageCode(). Sets recognition.lang to language code. Adds recognition.onresult handler: extracts transcript from results array normalizes transcript and correct word calculates similarity using calculateSimilarity() determines pass/fail using getSimilarityThreshold() calls showFeedback() with results calls resetListeningState(). Adds recognition.onerror handler: logs error calls resetListeningState(). Adds recognition.onend handler: calls resetListeningState() if still listening. Calls recognition.start() to begin listening.",10
restoreSavedState,"Restores game state from localStorage on page load. Validates saved values against current valid options to prevent bugs from stale data. Returns boolean indicating if state was restored.","Calls loadState() to get saved state object. Returns false if no state. Validates each saved property: if saved.voiceURI loads voices for language using loadVoicesForLanguage() finds voice by URI using findVoiceByURI() sets currentVoice if found. if saved.speed checks if speed is in VALID_SPEEDS array sets currentSpeed if valid. if saved.wordpackKey sets currentWordpackKey. if saved.act checks if act exists in loadedActs sets currentAct if valid. if saved.language extracts validLanguages from translations config checks if saved language in valid set sets nativeLanguage if valid. Returns true indicating state was restored.",9
validateAndFixState,"Validates current state against loaded data to ensure act and wordpack still exist. If invalid data detected resets to null forcing auto-selection. Prevents crashes from stale state referencing deleted packs.","Checks if currentAct is not null and not in loadedActs object: sets currentAct = null currentWordpackKey = null logs warning. Checks if currentAct valid but currentWordpackKey not in loadedActs[currentAct]: sets currentWordpackKey = null logs warning. Returns void.",9
loadLanguageData,"Async function that loads all acts for a language by loading each module from MODULE_URLS array. Stores decoded data in window.loadedActs and window.loadedActMeta globals. Validates target language consistency across acts.","Initializes window.loadedActs = {} and window.loadedActMeta = {}. Iterates through MODULE_URLS array with index. For each module: calls await decodeObfuscatedModule(url) extracts __actMeta from decoded data calculates actNumber = index + 1 stores metadata in loadedActMeta[actNumber] stores pack data in loadedActs[actNumber] logs success. After all loads: calls validateTargetLanguageConsistency() to ensure all acts have same target language. Logs total acts loaded. Returns void.",10
initFlashcardDeck,"Creates anti-decoupled flashcard deck where front and back are properties of same card object preventing sync issues. Maps word data to card objects with id front back properties. Returns shuffled deck.","Checks if currentWordpackKey or nativeLanguage invalid returns empty array. Gets pack from loadedActs[currentAct][currentWordpackKey]. Calls combineAndShuffleWords(pack difficulty) to get words with pedagogical ordering. Gets nativeLanguageConfig from translations. Extracts targetColumnIndex=0 translationColumnIndex from config. Checks if translation is Chinese for pinyin rendering. Maps each wordObj to flashcard object: generates unique id extracts front from word[targetColumnIndex] extracts back from word[translationColumnIndex] if target or translation is Chinese uses renderChineseText() creates object {id front back frontRaw backRaw}. Returns flashcard deck array.",9
flipCard,"Toggles flashcard between front and back states. Updates isFlipped flag recalculates flashcardShowingFront updates display saves state. Returns void.","Inverts window.isFlipped boolean flag. If showing starting card exits early. If in flashcard mode: inverts flashcardShowingFront flag calls updateFlashcardDisplay(). Otherwise: toggles 'flipped' class on flashcard element calls updateDisplay() for main card view. Calls saveState() to persist. Returns void.",8
nextCard,"Navigates to next flashcard in deck. Uses navigateToNext() utility then updates flashcard display specifically. Returns void.","Calls navigateToNext(flashcardDeck flashcardIndex) with callbacks: update callback calls updateFlashcardDisplay() save callback calls saveState(). Stores returned newIndex in flashcardIndex. Returns void.",8
prevCard,"Navigates to previous flashcard in deck. Uses navigateToPrevious() utility then updates flashcard display specifically. Returns void.","Calls navigateToPrevious(flashcardDeck flashcardIndex) with callbacks: update callback calls updateFlashcardDisplay() save callback calls saveState(). Stores returned newIndex in flashcardIndex. Returns void.",8
shuffleDeck,"Reshuffles the flashcard deck creating new random order. Resets index to 0 updates display saves state. Returns void.","Checks if flashcardDeck empty returns early if so. Calls shuffleArray(flashcardDeck) creates new shuffled array. Sets flashcardDeck = shuffled. Sets flashcardIndex = 0. Calls updateFlashcardDisplay(). Calls saveState(). Returns void.",8
autoSelectFirstActAndPack,"Auto-selects first available act and first pack within that act. Sets currentAct and currentWordpackKey globals. Populates pack dropdown and displays vocabulary. Used during initialization and language switching.","Gets first act number from loadedActs using Object.keys()[0] converts to number stores in currentAct. Calls populatePackDropdown(). Gets first pack key from loadedActs[currentAct] using Object.keys()[0] stores in currentWordpackKey. Calls displayVocabulary(). Returns void.",8
showStartingCard,"Displays the starting/title card explaining game rules and modes. Supports showing back side if showBack=true. Updates UI to match menu state.","Sets window.isStartingCardActive = true. Sets flashcard.classList to 'flashcard starting-card'. If showBack true adds 'flipped' class. Sets isFlipped = showBack. Gets targetLanguageDisplay from getTargetLanguage() + toTitleCase(). Determines gameTitle and gameDescription based on language. Sets spanishWord.innerHTML to title. Sets englishWord.innerHTML to description. Sets control buttons to hidden (display='none'). Shows menu button. Returns void.",6
exitStartingCard,"Exits the starting card and transitions to first vocabulary card. Calls startGame() to initialize deck. Hides starting card shows game controls.","Sets window.isStartingCardActive = false. Calls startGame() to create deck and start game loop. Returns void.",6
renderMenuCard,"Renders the menu card HTML with all setup options: act selector pack selector language selector voice selector speed buttons start button. Returns void.","Gets langName from targetLanguageDisplay or 'Target'. Determines typing descriptions based on isChineseMode(). Builds HTML string using template literals: dropdown for act selection populated with loadedActMeta dropdown for pack selection populated from current act dropdown for I speak language populated from translations config dropdown for voice selection populated from TTS voices speed buttons (0.3x 0.6x 0.9x) start practice button. Sets spanishWord.innerHTML to menu HTML. Sets englishWord.innerHTML to empty. Shows menu buttons (menu-btn prev-btn next-btn). Hides control buttons. Sets up event listeners: act change loads packs updates voice updates start button state pack change updates start button state language change updates voice updates back label start button enables voice selector loads new voices. Returns void.",5
switchMode,"Switches between game modes (reading listening speaking writing). Updates global currentMode state updates button UI starts game with new mode. Returns void.","Sets window.currentMode = newMode. Iterates through mode buttons: if button.dataset.mode === newMode sets aria-pressed='true' adds 'active' class otherwise sets aria-pressed='false' removes 'active' class. Calls exitStartingCard(). Calls startGame(). Calls saveState(). Returns void.",7
populateVoiceSelector,"Populates voice selector dropdown with available TTS voices for current language. Loads voices filters by language code populates options restores saved voice. Returns void.","Gets menuVoice element. Returns if not found. Gets language code from getTtsLanguageCode(). Calls loadVoicesForLanguage(languageCode currentVoice?.voiceURI). If no voices found sets innerHTML to 'No voices' disabled returns. Clears innerHTML. Iterates through voices: creates option element sets value to voiceURI sets textContent to voice.name if voice matches currentVoice?.voiceURI sets selected=true appends option. Sets onchange handler: gets selected voiceURI finds voice object using findVoiceByURI sets currentVoice updates back label saves state. Returns void.",7
initializeTooltips,"Initializes all tooltip HTML for mode buttons. Creates tooltip elements with formatted descriptions of mode functionality and controls. Uses createButtonTooltip() utility.","Defines tooltip HTML for each mode using template literals with TOOLTIP_MESSAGES constants. Reading mode: explains listening practicing flipping peeking pronouncing removing/adding controls. Listening mode: explains auto-pronunciation typing pinyin removal controls. Speaking mode: explains recording pronunciation scoring controls. Writing mode: explains translation typing controls. Calls createButtonTooltip() for each mode button passing HTML content. Returns void.",6
initializeApp,"Main initialization function runs on page load. Loads act data restores saved state validates state populates UI renders menu card sets up event listeners starts game.","Sets up initial state: hasStarted=false isMenuCardActive=true. Loads Act 1 data using await loadAct(1) stores in loadedActs[1] and loadedActMeta[1]. Sets currentAct=1. Gets first pack key from loadedActs[1] sets currentWordpackKey. Calls restoreSavedState() to load preferences. Calls validateAndFixState() to ensure valid state. Calls renderMenuCard() to show initial menu. Sets up event listeners: menu button toggles menu card prev/next buttons navigate flashcard prev/next buttons navigate fullscreen button toggles fullscreen mode buttons switch modes speed buttons set TTS speed. Calls initializeTooltips(). Calls updateBackLabel(). Calls saveState(). Returns void.",5
updateBackLabel,"Updates the 'Translation' label on card back to show current 'I speak' language in parentheses. For example 'Translation (English)' or 'Translation (ä¸­æ–‡)'.","Gets backLabel element returns if not found. Gets translations config from getTranslationsConfig(). Gets language config from translations[nativeLanguage]. If config found: extracts display name sets backLabel.textContent to 'Translation ({display})'. If config not found sets to 'Translation'. Returns void.",7
generateWeathering,"Generates random weathering CSS gradient for vintage flashcard effect. Uses seeded random for consistent weathering per card. Returns CSS gradient string.","Defines local random function using Math.sin(seed) * 10000 for pseudo-random seeded values. Generates random percentages for edge fades (top right bottom left) ranging 15-25%. Generates random RGB values for tint color: red 101-120 green 67-82 blue 33-43 creating sepia tone. Generates random edge and overall intensity values. Generates random spot positions for aging effects. Builds complex CSS gradient string using template literals: radial gradients for spots at random positions linear gradients for edge fades background tint color. Returns gradient CSS string.",5
updateDisplay,"Main display update function for flashcard game. Updates all UI elements based on current card and mode: front/back text typing inputs pronunciation buttons counters stamps. Handles Chinese rendering weathering effects button states.","Gets current card from deck. Updates wordpack title. Determines which side showing (front/back). Extracts displayed word and translation based on side. Updates spanish-word and english-word innerHTML handling Chinese rendering with renderChineseText(). Shows/hides mode-specific UI: listening mode shows typing input wrong letters wrong count speaking mode shows mic button score elements writing mode shows typing input for translation. Updates card counter with card numbers applies random rotation/scale. Generates weathering CSS using generateWeathering(card.id). Applies weathering to front/back elements. Updates pronunciation button states and labels. Updates prev/next button states. Shows appropriate control buttons based on mode. Handles edge case: shows peek button on front hides on back for most modes. Returns void.",4
unflipCard,"Unflips the flashcard back to front side. Opposite of flipCard(). Updates isFlipped state removes flipped class updates display.","Sets isFlipped = false. Removes 'flipped' class from flashcard.classList. Calls updateDisplay() to refresh UI. Returns void.",6
showFeedback,"Shows pronunciation feedback panel with score percentage color-coded message heard transcription expected word. Positions panel on front or back based on isFront parameter.","Selects feedback elements based on isFront: feedbackFront/feedbackBack scoreEl messageEl heardEl. Gets threshold for word using getSimilarityThreshold(expected). Calculates threshold percentage. Gets scoreClass using getScoreClass(score) for color. Gets feedbackMessage using getFeedbackMessage(score). Sets scoreEl.textContent to score rounded. Sets scoreEl.className to scoreClass. Sets messageEl.textContent to feedbackMessage. Sets heardEl.textContent to 'You said: {heard}'. Shows feedback element with display='block'. If score >= threshold (pass): shows success stamp with callback to remove card after delay. If score < threshold (fail): shows failure stamp with callback to add duplicate cards. Returns void.",6
startGame,"Initializes or restarts the game. Creates deck from pack applies difficulty filter initializes game state shows first card updates display.","Checks if gameStarted false OR difficulty changed OR pack changed. If needs new deck: calls createDeckFromPack() with current pack translation columns difficulty stores in currentDeck makes copy to originalDeck sets currentIndex=0 sets gameStarted=true. Hides menu card and starting card. Shows control separator. Removes 'flipped' class from flashcard. Sets isFlipped=false. Calls updateDisplay(). Calls saveState(). Returns void.",5
getAudioContext,"Gets or creates Web Audio API context singleton. Located in game-sounds.js. Returns audioContext for generating sound effects.","Checks if module-level audioContext variable is null. If null creates new AudioContext or webkitAudioContext (Safari). Returns audioContext. This singleton pattern prevents multiple context creation which causes issues.",10
playCardFlipSound,"Plays soft page-turn sound using Web Audio API. Generates muffled white noise with lowpass filters. Duration 0.23 seconds. Uses module audioContext singleton.","Gets context from getAudioContext(). Creates audio buffer 0.23 seconds long. Fills buffer with random noise values with sine envelope for smooth attack/decay. Creates buffer source and connects to two lowpass filters (400Hz 580Hz) for muffled effect. Connects through gain node (volume 2.5) to destination. Starts playback. No return value.",10
playDingSound,"Plays success bell sound (C5 E5 G5 chord). Gentle satisfying sound for correct answers achievements. Duration 0.6 seconds with exponential decay.","Gets context from getAudioContext(). Defines frequencies array [523.25 659.25 783.99] (C5 E5 G5). Iterates through frequencies: creates oscillator with sine wave creates lowpass filter (1500Hz warmth) creates gain node sets volume with exponential decay (0.2 0.16 0.12 by index) connects oscâ†’filterâ†’gainâ†’destination staggers start times by 0.03s. Returns void.",10
playBuzzSound,"Plays failure buzz sound (D4 A3 descending). Gentle two-tone rejection sound for wrong answers errors. Duration 0.15 seconds per note.","Gets context from getAudioContext(). Defines notes array [293.66 220] (D4 A3 descending). Iterates through notes: creates oscillator (sine) and lowpass filter (800Hz gentle) creates gain node with exponential decay connects oscâ†’filterâ†’gainâ†’destination staggers notes by 0.12s. Returns void.",10
playButtonClickSound,"Plays UI click sound. Crisp satisfying snap with subtle low end. Duration 0.03 seconds. Used for button presses menu interactions.","Gets context from getAudioContext(). Creates 0.03s buffer filled with exponential decay noise. Creates buffer source and two lowpass filters (800Hz 1200Hz) for muffled click. Creates sine oscillator (120Hzâ†’60Hz) for subtle body. Connects sourceâ†’lp1â†’lp2â†’gain (0.75)â†’destination. Connects oscâ†’oscGain (0.05)â†’destination. Starts both sources. Returns void.",10
playKeyboardSound,"Plays mechanical keyboard sound (reference implementation currently unused). High-frequency clicky sound with highpass and bandpass filters. Duration 0.04 seconds.","Gets context from getAudioContext(). Creates 0.04s buffer with exponential decay noise. Creates highpass filter (2000Hz) and bandpass filter (4500Hz Q=2) for clicky sound. Connects sourceâ†’hpâ†’bpâ†’gain (0.3)â†’destination. Starts playback. Returns void.",8
playScribbleSound,"Plays typing sound for each keypress. Clicky mechanical keyboard sound with randomization for natural feel. Duration 0.015-0.025 seconds randomized per call.","Gets context from getAudioContext(). Generates random duration 0.015-0.025s. Creates buffer filled with sharp decay noise. Creates two bandpass filters: bp1 (2000-3500Hz Q=4 clicky range) randomized bp2 (1000-1500Hz Q=2.5 body) randomized. Creates highpass filter (400Hz remove mud). Connects sourceâ†’hpâ†’bp1â†’bp2â†’gain (0.8)â†’destination. Starts playback. Randomization creates natural varied typing sound. Returns void.",10
