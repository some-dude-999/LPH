Function Name,What It Does,How Does It Work,Reusability Score (1-10)
switchLanguage,"Switches between target languages (Chinese, Spanish, English) by reloading page with new language in localStorage","Validates language exists in MODULE_SETS, saves language to localStorage with key 'selected_language', sets window.currentLanguage and window.MODULE_URLS, console logs the switch, calls window.location.reload() to reinitialize app with new modules",9
getTargetLanguage,"Returns the current target language being learned based on loaded modules","Checks if window.loadedActMeta exists, iterates through act numbers, returns meta.wordColumns[0].toLowerCase() from first act found, returns null if none",9
toTitleCase,"Converts a string to title case (first letter capitalized)","Returns empty string if falsy input, uses charAt(0).toUpperCase() for first letter, concatenates with slice(1).toLowerCase() for rest",10
validateTargetLanguageConsistency,"Validates that all loaded acts are for the same target language","Creates Set of languages, iterates loadedActMeta to collect wordColumns[0] from each act, checks if Set.size > 1 (inconsistent), logs error with language list, returns boolean",8
isChineseMode,"Returns true if current target language is Chinese","Calls getTargetLanguage() and checks if result === 'chinese'",10
updateChineseModeClass,"Adds/removes 'chinese-mode' CSS class on body element based on target language","Calls isChineseMode(), if true adds 'chinese-mode' class to document.body.classList, else removes it",8
getTranslationsConfig,"Returns translations config from loaded act metadata (__actMeta.translations)","Checks if window.loadedActMeta exists, iterates through act numbers, returns meta.translations from first act found, returns null if none",9
getDefaultTranslation,"Returns default translation language from loaded act metadata","Checks if window.loadedActMeta exists, iterates through act numbers, returns meta.defaultTranslation from first act found, defaults to 'english' if none",9
getWordColumns,"Returns word column structure from loaded act metadata","Checks if window.loadedActMeta exists, iterates through act numbers, returns meta.wordColumns array from first act found, returns null if none",9
getValidLanguages,"Returns list of valid native language options from translations config","Calls getTranslationsConfig(), returns Object.keys(translations) if exists, otherwise empty array",9
getTtsLanguageCode,"Returns language code for text-to-speech based on target language (es-ES, zh-CN, en-US)","Iterates loadedActMeta to get wordColumns[0], converts to lowercase, uses langMap object to convert language name to locale code (spanish→es-ES, chinese→zh-CN, english→en-US, etc.), returns mapped code or null",10
decodeObfuscatedModule,"Decodes obfuscated modules using 3-layer deobfuscation (base64 + zlib + string reversal)","Async imports module from URL, extracts module.w (compressed base64 string), decodes base64 with atob() and converts to Uint8Array, decompresses with pako.inflate(), decodes binary to UTF-8 string with TextDecoder, reverses string with split('').reverse().join(''), parses reversed string as JSON, returns parsed object, throws error on failure",10
loadAct,"Loads and decodes an act module, extracts metadata, caches it in loadedActs and loadedActMeta","Validates MODULE_URLS exists, calculates module index (actNumber - 1), validates index in range, gets URL from MODULE_URLS[index], calls decodeObfuscatedModule() with URL, extracts __actMeta from decoded data, deletes __actMeta property from data, returns object with { actMeta, packs }",10
shuffleArray,"Fisher-Yates shuffle algorithm for randomizing arrays","Creates copy of input array with spread operator, iterates backwards from length-1 to 1, for each position generates random index j from 0 to i using Math.floor(Math.random() * (i+1)), swaps elements at positions i and j using destructuring assignment, returns shuffled copy without modifying original",10
combineAndShuffleWords,"Combines base and example words with controlled shuffling (base first, examples second)","Extracts baseWords and exampleWords arrays from pack, shuffles baseWords with shuffleArray() and tags each as {word, type:'Base Word'}, shuffles exampleWords and tags as {word, type:'Example Word'}, checks difficulty parameter: 'easy'=return base only, 'medium'=return examples only, 'hard'=concatenate [shuffledBase, shuffledExamples] (base first), logs counts, returns combined array",10
normalizeChar,"Normalizes characters for typing comparison (removes accents, converts to lowercase)","Returns empty string if falsy, chains toLowerCase(), normalize('NFD') to decompose accented characters, replace(/[\u0300-\u036f]/g, '') to remove combining diacritical marks, returns normalized character",10
findNextTypingPosition,"Finds the next untyped position in a word for typing validation","Iterates through chars array to find first position not in typedPositions Set, if none found returns -1 (complete), enters while loop to skip spaces: marks space positions as typed by adding to Set, increments nextPos, exits loop when non-space found or end reached, returns nextPos or -1",10
checkTypingKey,"Checks if a typed key matches the target character (accent-insensitive)","Returns 'space' if key is space character (ignored), normalizes both key and targetChar with normalizeChar(), compares normalized strings, returns 'correct' if equal else 'wrong'",10
isWordComplete,"Checks if all positions in a word have been typed correctly","Filters chars array to count non-space characters, compares typedPositions.size >= nonSpaceCount, returns boolean",10
coupleChineseWithPinyin,"Couples Chinese characters with pinyin syllables into {char, pinyin} objects, handles Latin blocks","Splits pinyin by whitespace into array, initializes result array and pinyinIndex counter, iterates through each character in chinese string, uses regex /[a-zA-Z]/.test() to detect Latin letters, if Latin maps char to itself {char, pinyin:char}, if Chinese maps to next pinyin syllable {char, pinyin:pinyinParts[pinyinIndex]} and increments pinyinIndex, returns array of coupled objects",10
renderChineseWithPinyin,"Renders coupled Chinese+pinyin array as HTML with characters above pinyin","Creates span container with 'chinese-coupled' class, iterates coupledArray, for each creates 'char-group' span, appends 'chinese-char' span with character and 'pinyin' span with pinyin syllable, appends char-group to container, returns container element",10
renderChineseText,"Convenience function that couples and renders Chinese text with pinyin","Calls coupleChineseWithPinyin(chinese, pinyin) to get coupled array, passes result to renderChineseWithPinyin(), returns HTML element",10
getChineseHtml,"Returns HTML string for Chinese text with pinyin (non-DOM version of renderChineseText)","Calls renderChineseText(chinese, pinyin) to get DOM element, accesses .outerHTML property, returns HTML string",10
saveState,"Saves state object to localStorage with the given storage key","Uses try-catch block, calls JSON.stringify() on state object, calls localStorage.setItem() with STORAGE_KEY and stringified state, logs warning on error",10
loadState,"Loads and parses state from localStorage with error handling","Uses try-catch block, calls localStorage.getItem() with STORAGE_KEY, if result exists parses with JSON.parse() and returns object, returns null if no stored state or on error, logs warning on error",10
toggleDebugMode,"Toggles debug mode visibility when Ctrl+` is pressed","Flips window.DEBUG_MODE boolean, finds debug table element by ID, if found sets display style to 'block' or 'none' based on new state, calls updateDebugTable() when enabling, logs new state, returns boolean",8
updateDebugTable,"Updates debug table with current deck state, can show confused cards or full deck","Gets options parameter with defaults (showConfused=false, deckToShow=currentDeck), determines which deck to display (confused or full), gets table body element, generates HTML rows for each card with index, word type, target word, translation, clears tbody.innerHTML and injects new HTML, handles Chinese coupling if in Chinese mode, can show simulate buttons based on mode",7
initializeDebugUI,"Initializes debug UI with language switcher and deck state visualization","Creates debug table container HTML with language radio buttons (Chinese/Spanish/English), deck state table headers, confused cards toggle, appends to document body, attaches event listeners to language radios (call switchLanguage on change), attaches listener to show confused checkbox (filters deck display), sets up Ctrl+` keyboard listener to call toggleDebugMode(), initially hides debug UI",8
normalizePronunciationText,"Normalizes text for pronunciation comparison (lowercase, removes spaces/punctuation)","Converts to lowercase, uses normalize('NFD') for decomposition, removes diacritics with replace(/[\u0300-\u036f]/g, ''), removes spaces with replace(/\s+/g, ''), handles language-specific cases (Chinese: keeps characters and Latin, removes punctuation; others: keeps alphanumeric only), returns normalized string",10
getSimilarityThreshold,"Returns similarity threshold percentage based on word length","Uses if-else chain: words <= 4 chars return 0.6 (60%), 5-8 chars return 0.7 (70%), > 8 chars return 0.75 (75%), longer words require higher accuracy",10
levenshteinDistance,"Calculates edit distance between two strings for fuzzy matching","Creates 2D matrix (str1.length+1 x str2.length+1), initializes first row/column with indices (base cases), uses nested loops to fill matrix, for each cell compares characters: if match copies diagonal value, if mismatch takes min(left+1, top+1, diagonal+1), returns bottom-right corner value (total edit distance)",10
calculateSimilarity,"Calculates pronunciation similarity percentage using Levenshtein distance","Normalizes both expected and heard with normalizePronunciationText(language), calculates edit distance with levenshteinDistance(), computes similarity as (1 - distance/maxLength) * 100, clamps result between 0-100, rounds to integer, returns percentage",10
getFeedbackMessage,"Returns feedback message based on pronunciation score (Excellent/Good/Fair/Keep Trying)","Uses if-else chain: score >= 90 returns 'Excellent!', >= 75 returns 'Good!', >= 60 returns 'Fair', else 'Keep Trying!'",10
getScoreClass,"Returns CSS class name based on pronunciation score (excellent/good/fair/poor)","Uses if-else chain: score >= 90 returns 'excellent', >= 75 returns 'good', >= 60 returns 'fair', else 'poor'",10
updatePronunciationDebug,"Updates debug panel with pronunciation attempt details","Finds debug info element by ID, if exists creates HTML table with expected word, heard word, similarity score, feedback message, threshold percentage, uses getScoreClass() for color coding, injects HTML into debugInfo.innerHTML",7
hideFeedback,"Hides pronunciation feedback elements","Iterates array of feedback elements, removes 'visible' class from each classList",7
normalizeString,"Normalizes strings for duplicate detection (lowercase, removes spaces/symbols)","Converts to lowercase, uses normalize('NFD') for decomposition, removes diacritics with replace(/[\u0300-\u036f]/g, ''), removes spaces with replace(/\s+/g, ''), removes non-alphanumeric with replace(/[^a-z0-9]/g, ''), returns normalized string",10
generateWrongAnswers,"Generates N wrong answers for multiple choice from act-wide word pool with duplicate filtering","Extracts all native language translations from entire act, normalizes correctAnswer, filters pool to exclude correct answer using normalized comparison, shuffles filtered pool, takes first count items, returns array of wrong answers",10
generateWrongAnswersWithPinyin,"Generates wrong answers with pinyin for multiple choice (Chinese-specific)","Similar to generateWrongAnswers but includes pinyin, extracts Chinese+pinyin pairs from entire act, normalizes correctAnswer Chinese text, filters pool excluding correct answer, shuffles pool, takes first count items, returns array of {chinese, pinyin} objects",10
showStamp,"Shows stamp element with sound, waits duration, then calls callback","Adds 'visible' class to stamp element, calls soundFunction() to play audio, uses setTimeout() with duration parameter (default 1500ms), in timeout removes 'visible' class and calls onComplete callback if provided",9
showSuccessStamp,"Shows success stamp with ding sound for 1.5 seconds","Calls showStamp(stampElement, playDingSound, onComplete, 1500) with ding sound function and default 1.5s duration",9
showFailureStamp,"Shows failure stamp with buzz sound for 1.5 seconds","Calls showStamp(stampElement, playBuzzSound, onComplete, 1500) with buzz sound function and default 1.5s duration",9
loadVoicesForLanguage,"Loads and filters TTS voices for a specific language code","Calls speechSynthesis.getVoices() to get all system voices, filters array where voice.lang starts with languageCode parameter (e.g., 'es-ES' matches 'es-'), sorts filtered voices by .localService (local voices first), returns sorted array",10
speakWord,"Speaks text using text-to-speech with configurable voice, speed, volume","Cancels any active speech with speechSynthesis.cancel(), creates new SpeechSynthesisUtterance with text, destructures options object for languageCode/voice/speed/volume/onEnd, sets utterance.lang if languageCode provided, sets utterance.voice if voice object provided, sets utterance.rate (default 0.6), sets utterance.volume (default 1.0), attaches onend handler if provided, calls speechSynthesis.speak(utterance)",10
findVoiceByURI,"Finds a TTS voice object by its voiceURI from available voices array","Uses Array.find() to search voices array, compares voice.voiceURI === voiceURI parameter, returns matched voice object or undefined if not found",10
initializeTypingState,"Initializes typing state for a word (positions, display, wrong tracking)","Splits word into characters array, creates empty Set for typedPositions, creates display array (empty strings), initializes wrongAttempts counter to 0, creates empty Set for wrongPositions, creates empty array for wrongLetters, returns object with all state properties",10
getTypingDisplay,"Returns typing display string showing typed letters and X for untyped positions","Iterates through chars array with map, for each position checks if in typedPositions Set, if typed returns actual character, if not typed returns 'X', joins array into string, returns display string",10
removeCard,"Removes card at current index from deck and returns new deck and index","Checks if deck is empty (returns as-is), creates new deck copy with spread, uses splice() to remove card at currentIndex, adjusts index if >= new deck length (wraps to 0), returns {deck: newDeck, newIndex}",10
addDuplicateCards,"Adds N duplicate copies of a card to deck after current position","Creates new deck copy with spread, calculates insertion position (currentIndex + 1), uses Array.from({length: count}) to create count copies, uses splice() to insert copies after current position, returns {deck: newDeck, newIndex: currentIndex}",10
createDeckFromPack,"Creates a game deck from a wordpack with translation and typing target fields","Calls combineAndShuffleWords(pack, difficulty) to get word objects, extracts translationColIndex from options (default 1 for English), maps each word object to card with targetWord (col 0), translation (col translationColIndex), typingTarget (pinyin if Chinese mode else targetWord), pinyin if Chinese, adds id with random seed, returns array of card objects",10
populateActSelector,"Populates act dropdown with act names from loaded metadata and attaches change handler","Clears select element innerHTML, gets act numbers from loadedActMeta keys sorted numerically, iterates act numbers to create option elements, sets option.value = actNumber, sets option.textContent = actMeta.actName, appends option to select, if onChange callback provided attaches change event listener that parses selected value and calls onChange(actNum)",9
populatePackSelector,"Populates pack dropdown with pack titles from act data and attaches change handler","Clears select element innerHTML, gets pack keys from actData sorted by pack number (extracts number from key), iterates pack keys to create options, extracts pack title from meta.english (or meta.chinese for Chinese mode), sets option.value = packKey, textContent = title, appends option, if onChange provided attaches change listener",9
populateNativeLanguageSelector,"Populates native language dropdown from translations config and attaches change handler","Clears select element innerHTML, iterates translations object entries (language code and config), creates option for each with value = language code, textContent = config.display, appends options, sets select.value to currentValue if provided, if onChange callback provided attaches change event that calls onChange(selectedLang)",9
navigateToPrevious,"Navigates to previous card in deck with wraparound and callbacks","Checks if state.currentIndex > 0, if yes decrements index, if no wraps to deck.length - 1 (circular), if callbacks.onNavigate provided calls it, if callbacks.afterNavigate provided calls it after 300ms delay for animations",9
navigateToNext,"Navigates to next card in deck with wraparound and callbacks","Increments state.currentIndex, wraps with modulo deck.length (circular), if callbacks.onNavigate provided calls it, if callbacks.afterNavigate provided calls it after 300ms delay",9
resetDeckToOriginal,"Resets current deck to original deck state and triggers callbacks","Creates copy of originalDeck with spread operator, if callbacks.onReset provided calls it with newDeck parameter (allows game to update state), if callbacks.afterReset provided calls it",9
navigateToNextPack,"Finds and returns the next wordpack key in sequence","Extracts pack keys from wordpacks object, sorts by pack number (parses from key string), finds current pack index in sorted array, increments index with modulo length (wraps to 0 after last), returns next pack key",9
setTTSSpeed,"Sets TTS speed and updates active button styling","Iterates speed buttons array, removes 'active' class from all, finds button with matching data-speed attribute, adds 'active' class to matched button, returns speed value",8
renderTypingDisplayHTML,"Renders typing display as HTML with color coding for typed/untyped/wrong letters","Iterates typingDisplay characters with map, for each position creates span element, if in wrongPositions adds 'wrong' class (red), if typed adds 'typed' class (green), if untyped adds 'untyped' class (gray X), sets span.textContent = character, returns joined HTML string",10
renderTargetWordHTML,"Renders target word as HTML, handles Chinese with pinyin coupling","Checks if isChineseTarget flag is true, if yes calls getChineseHtml(card.targetWord, card.pinyin) to render coupled Chinese+pinyin, if no returns plain card.targetWord text, returns HTML string",10
renderTranslationHTML,"Renders translation text as HTML, handles Chinese translations with pinyin","Checks if translation column is Chinese (column index matches Chinese position), if yes calls getChineseHtml(translationChinese, translationPinyin), if no returns plain translation text, returns HTML string",10
createButtonTooltip,"Creates and attaches a tooltip to a button with HTML content and hover behavior","Creates tooltip div element with 'tooltip' class, sets innerHTML to htmlContent parameter, appends tooltip to button, attaches mouseenter listener that positions tooltip (getBoundingClientRect, calculates top/left, adds 'show' class), attaches mouseleave listener that removes 'show' class, returns tooltip element",9
updateWordpackTitleDisplay,"Updates wordpack title display element with pack title from wordpacks dictionary","Gets pack object from wordpacks[packKey], extracts title from pack.meta.english (or pack.meta.chinese if Chinese mode), sets titleElement.textContent = title",8
simulateCorrectAnswer,"Debug function to simulate correct answer and remove card from deck","Checks if deck is empty (early return), increments pendingDeckChange by -1, calls updateDisplay(), shows success stamp, in stamp callback calls removeCard() to remove current card, updates deck and index, resets pendingDeckChange to 0, plays card flip sound, calls onSuccess callback if provided",7
simulateWrongAnswer,"Debug function to simulate wrong answer and add penalty duplicate cards","Checks if deck is empty (early return), increments pendingDeckChange by duplicateCount, calls updateDisplay(), shows failure stamp, in stamp callback calls addDuplicateCards() to add copies, updates deck and index, resets pendingDeckChange, plays sound, advances to next card, calls onFailure if provided",7
simulateNearVictory,"Debug function to simulate near-victory state with only 1 card remaining","Checks if deck is empty (early return), creates new deck with only first card, sets currentIndex to 0, calls updateDisplay(), calls onSimulate callback with new deck if provided",7
getAudioContext,"Creates and returns singleton AudioContext for Web Audio API","Checks if window.audioContext already exists, if not creates new AudioContext(), stores in window.audioContext, handles browser prefixes (AudioContext or webkitAudioContext), returns singleton context",10
playTypingSound,"Plays mechanical keyboard typing click sound using Web Audio API","Gets audio context with getAudioContext(), creates OscillatorNode with frequency 800Hz and type 'sine', creates GainNode with exponential ramp from 0.1 to 0.001 over 0.05s, connects oscillator→gain→destination, starts oscillator immediately, stops after 0.05s",10
handleTypingInput,"Handles typing input validation, updates state, returns status (correct/wrong/incomplete)","Gets next typing position with findNextTypingPosition(), calls checkTypingKey() to validate key against target character, if 'space' returns {status: 'space'}, if 'wrong' adds letter to wrongLetters with random rotation/scale, increments wrongAttempts, adds position to wrongPositions, returns {status: 'wrong'}, if 'correct' marks position as typed, updates display character, checks isWordComplete() and returns {status: 'complete'} or {status: 'incomplete'}",10
resetListeningState,"Resets speech recognition state and button styling","Removes 'listening' class from record button, adds 'idle' class, sets global isListening flag to false, stops recognition if active with recognition.stop()",9
startListeningForPronunciation,"Starts speech recognition for pronunciation practice and scores the attempt","Sets recognition.lang to languageCode, changes button state to 'listening', sets isListening flag true, starts recognition.start(), attaches onresult handler that iterates transcript alternatives, normalizes each, calculates similarity score with calculateSimilarity(), uses best score, calls resetListeningState(), calls onResult callback with score/heard/expected, attaches onerror handler that resets state and calls onError callback if provided, attaches onend handler for cleanup",10
restoreSavedState,"Restores saved state from localStorage with validation against valid options","Calls loadState() to get saved state object, if null returns false, validates language against VALID_LANGUAGES array, validates act exists in loadedActMeta, validates pack exists in loadedActs[act], validates native language using getValidLanguages(), only restores values that pass validation, returns boolean indicating if valid state was found",9
validateAndFixState,"Validates restored state against loaded data (ensures act and pack exist)","Checks if currentAct exists in loadedActs, if not sets to null, checks if currentPack exists in loadedActs[currentAct], if not sets to null, ensures user doesn't have invalid references to deleted acts/packs",9
loadLanguageData,"Loads all act modules for a language and populates loadedActs and loadedActMeta","Initializes window.loadedActs and window.loadedActMeta objects, gets module list from LANGUAGE_CONFIG[language].modules, iterates modules array, for each calls loadAct(act.act) to decode module, stores result.packs in loadedActs[actNumber], stores result.actMeta in loadedActMeta[actNumber], logs success messages, calls updateChineseModeClass() at end",10
initFlashcardDeck,"Initializes flashcard deck with anti-decoupled front/back card objects","Gets selected pack from loadedData, calls combineAndShuffleWords() to get words, maps each word to flashcard object with front (target word), back (translation), id (for React-like key), stores anti-decoupled objects where front and back are properties of SAME object, sets flashcardDeck state, resets index to 0, sets showing front to true",9
flipCard,"Toggles flashcard between front and back","Flips flashcardShowingFront boolean, updates display to show either deck[index].front or deck[index].back based on flag",9
nextCard,"Advances to next flashcard with wraparound","Increments flashcardIndex, wraps with modulo deck.length, resets showing to front, updates display",9
prevCard,"Goes to previous flashcard with wraparound","Decrements flashcardIndex with (index - 1 + length) % length for negative wraparound, resets showing to front, updates display",9
shuffleDeck,"Shuffles flashcard deck using Fisher-Yates algorithm","Calls shuffleArray(flashcardDeck) to get new shuffled order (anti-decoupling preserved - objects stay intact), updates flashcardDeck state, resets index to 0, resets showing to front, updates display",9
autoSelectFirstActAndPack,"DRY helper that auto-selects first available act and pack","Gets sorted act numbers from loadedActMeta, if none returns early, selects first act number, gets pack keys from loadedData[firstAct] sorted by pack number, if packs exist selects first pack, updates state, populates dropdowns, displays vocabulary, saves state",8
